(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"+w+S":function(e,t,n){"use strict";n.d(t,"a",(function(){return A}));var r=n("rePB"),i=n("1OyB"),a=n("vuIU"),o=n("ReuC"),s=n("Ji7U"),c=n("md7G"),u=n("foSv"),l=n("Jh/b"),h=n("K4gp"),f=n("91Zk"),p=n("BQ9P"),d=n("K7jV"),y=n("0i8A"),m=n("iein"),v=n("f5Sf"),b=n("ykdB"),g=n("d3kR"),O=n("tMmZ"),_=n("HIr8");function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var i=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}function E(e,t){(e.COLOR_0||e.colors)&&t||(e.colors={constant:!0,value:new Float32Array([1,1,1])}),l.a.assert(e.positions||e.POSITION,'no "postions" or "POSITION" attribute in mesh')}function P(e,t){if(e.attributes)return E(e.attributes,t),e instanceof y.a?e:new y.a(e);if(e.positions||e.POSITION)return E(e,t),new y.a({attributes:e});throw Error("Invalid mesh")}var x={mesh:{value:null,type:"object",async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:function(e){return e.position}},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]}},A=function(e){Object(s.a)(n,e);var t=S(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"getShaders",value:function(){var e=!Object(m.i)(this.context.gl),t={};return Object(g.b)(this.context.gl,O.a.GLSL_DERIVATIVES)&&(t.DERIVATIVES_AVAILABLE=1),Object(o.a)(Object(u.a)(n.prototype),"getShaders",this).call(this,{vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = instancePickingColors;\n\n  vTexCoord = texCoords;\n  cameraPosition = project_uCameraPosition;\n  normals_commonspace = project_normal(instanceModelMatrix * normals);\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n  geometry.normal = normals_commonspace;\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\n\n  if (composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\n  }\n\n  geometry.position = position_commonspace;\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[h.a,f.b,p.a],transpileToGLSL100:e,defines:t})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:_.a}),this.setState({emptyTexture:new v.a(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}},{key:"updateState",value:function(e){var t=e.props,r=e.oldProps,i=e.changeFlags;if(Object(o.a)(Object(u.a)(n.prototype),"updateState",this).call(this,{props:t,oldProps:r,changeFlags:i}),t.mesh!==r.mesh||i.extensionsChanged){var a;if(null===(a=this.state.model)||void 0===a||a.delete(),t.mesh){this.state.model=this.getModel(t.mesh);var s=t.mesh.attributes||t.mesh;this.setState({hasNormals:Boolean(s.NORMAL||s.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==r.texture&&this.setTexture(t.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}},{key:"finalizeState",value:function(){Object(o.a)(Object(u.a)(n.prototype),"finalizeState",this).call(this),this.state.emptyTexture.delete()}},{key:"draw",value:function(e){var t=e.uniforms;if(this.state.model){var n=this.context.viewport,r=this.props,i=r.sizeScale,a=r.coordinateSystem,o=r._instanced;this.state.model.setUniforms(t).setUniforms({sizeScale:i,composeModelMatrix:!o||Object(_.b)(n,a),flatShading:!this.state.hasNormals}).draw()}}},{key:"getModel",value:function(e){var t=new b.a(this.context.gl,w(w({},this.getShaders()),{},{id:this.props.id,geometry:P(e,this.props._useMeshColors),isInstanced:!0})),n=this.props.texture,r=this.state.emptyTexture;return t.setUniforms({sampler:n||r,hasTexture:Boolean(n)}),t}},{key:"setTexture",value:function(e){var t=this.state,n=t.emptyTexture,r=t.model;null==r||r.setUniforms({sampler:e||n,hasTexture:Boolean(e)})}}]),n}(d.a);A.layerName="SimpleMeshLayer",A.defaultProps=x},"FJ6+":function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return i})),n.d(t,"f",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c}));var r={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},i={ADD:1,REPLACE:2},a={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},o={I3S:"I3S",TILES3D:"TILES3D"},s={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},c={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0}},FR1t:function(e,t,n){"use strict";n.d(t,"a",(function(){return T}));var r=n("rePB"),i=n("1OyB"),a=n("vuIU"),o=n("ReuC"),s=n("Ji7U"),c=n("md7G"),u=n("foSv"),l=n("K4gp"),h=n("91Zk"),f=n("BQ9P"),p=n("K7jV"),d=n("ykdB"),y=n("0i8A");function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(u.a)(e);if(t){var i=Object(u.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var g=[0,0,0,255],O=[0,0,1],_={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:function(e){return e.position}},getNormal:{type:"accessor",value:O},getColor:{type:"accessor",value:g},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};var T=function(e){Object(s.a)(n,e);var t=b(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"getShaders",value:function(){return Object(o.a)(Object(u.a)(n.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.normal = project_normal(instanceNormals);\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(positions.xy * radiusPixels, 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\n  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n  vColor = vec4(lightColor, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[l.a,h.a,f.a]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:O},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:g}})}},{key:"updateState",value:function(e){var t,r,i,a=e.props,s=e.oldProps,c=e.changeFlags;if(Object(o.a)(Object(u.a)(n.prototype),"updateState",this).call(this,{props:a,oldProps:s,changeFlags:c}),c.extensionsChanged){var l,h=this.context.gl;null===(l=this.state.model)||void 0===l||l.delete(),this.state.model=this._getModel(h),this.getAttributeManager().invalidateAll()}c.dataChanged&&(t=a.data,r=t.header,i=t.attributes,r&&i&&(t.length=r.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0&&(i.instanceColors=i.COLOR_0)))}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,r=this.props,i=r.pointSize,a="meters"===r.sizeUnits?1/n.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({radiusPixels:i*a}).draw()}},{key:"_getModel",value:function(e){for(var t=[],n=0;n<3;n++){var r=n/3*Math.PI*2;t.push(2*Math.cos(r),2*Math.sin(r),0)}return new d.a(e,v(v({},this.getShaders()),{},{id:this.props.id,geometry:new y.a({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0}))}}]),n}(p.a);T.layerName="PointCloudLayer",T.defaultProps=_},"G+eI":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("1OyB"),i=n("vuIU"),a=n("OyGM"),o=function(){function e(t,n){Object(r.a)(this,e),this.name=t,this.type=n,this.sampleSize=1,this.reset()}return Object(i.a)(e,[{key:"setSampleSize",value:function(e){return this.sampleSize=e,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(e){return this._count+=e,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(e){return this._count-=e,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Object(a.a)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Object(a.a)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),e}(),s=function(){function e(t){var n=t.id,i=t.stats;Object(r.a)(this,e),this.id=n,this.stats={},this._initializeStats(i),Object.seal(this)}return Object(i.a)(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}},{key:"size",get:function(){return Object.keys(this.stats).length}},{key:"reset",value:function(){for(var e in this.stats)this.stats[e].reset();return this}},{key:"forEach",value:function(e){for(var t in this.stats)e(this.stats[t])}},{key:"getTable",value:function(){var e={};return this.forEach((function(t){e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}})),e}},{key:"_initializeStats",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach((function(t){return e._getOrCreate(t)}))}},{key:"_getOrCreate",value:function(e){if(!e||!e.name)return null;var t=e.name,n=e.type;return this.stats[t]||(this.stats[t]=e instanceof o?e:new o(t,n)),this.stats[t]}}]),e}()},G8qk:function(e,t,n){"use strict";n.d(t,"a",(function(){return tt}));var r=n("o0o1"),i=n.n(r),a=n("rePB"),o=(n("ls82"),n("HaE+")),s=n("1OyB"),c=n("vuIU"),u=n("Ji7U"),l=n("md7G"),h=n("foSv"),f=n("0i8A"),p=n("V3d6"),d=n("5lV4"),y=n("FR1t"),m=n("ReuC"),v=n("K4gp"),b=n("BQ9P"),g=n("Jh/b"),O=n("K7jV"),_=n("iein"),T=n("+Jdq"),w=n("IIFb"),S=n("NY3r"),E=n("p/I1");function P(){return(P=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t.scenes.forEach((function(e){e.traverse((function(e){Object.values(e.model.getUniforms()).forEach((function(e){!1===e.loaded&&n.push(e)}))}))})),e.next=4,x((function(){return n.some((function(e){return!e.loaded}))}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return A.apply(this,arguments)}function A(){return(A=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t()){e.next=5;break}return e.next=3,new Promise((function(e){return requestAnimationFrame(e)}));case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=n("HIr8");function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var N=[255,255,255,255],R={scenegraph:{type:"object",value:null,async:!0},getScene:function(e){return e&&e.scenes?"object"==typeof e.scene?e.scene:e.scenes[e.scene||0]:e},getAnimator:function(e){return e&&e.animator},_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:function(e){return e.position}},getColor:{type:"accessor",value:N},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[E.a]},L=function(e){Object(u.a)(n,e);var t=M(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getShaders",value:function(){var e=[v.a,b.a];return"pbr"===this.props._lighting&&e.push(T.a),{vs:"#version 300 es\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform mat4 sceneModelMatrix;\nuniform bool composeModelMatrix;\nin vec4 POSITION;\n\n#ifdef HAS_UV\n  in vec2 TEXCOORD_0;\n#endif\n\n#ifdef MODULE_PBR\n  #ifdef HAS_NORMALS\n    in vec4 NORMAL;\n  #endif\n#endif\nout vec4 vColor;\n#ifndef MODULE_PBR\n  #ifdef HAS_UV\n    out vec2 vTEXCOORD_0;\n  #endif\n#endif\nvoid main(void) {\n  #if defined(HAS_UV) && !defined(MODULE_PBR)\n    vTEXCOORD_0 = TEXCOORD_0;\n    geometry.uv = vTEXCOORD_0;\n  #endif\n\n  geometry.worldPosition = instancePositions;\n  geometry.pickingColor = instancePickingColors;\n\n  #ifdef MODULE_PBR\n    #ifdef HAS_NORMALS\n      pbr_vNormal = project_normal(instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz);\n      geometry.normal = pbr_vNormal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = TEXCOORD_0;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  float originalSize = project_size_to_pixel(sizeScale);\n  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);\n\n  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;\n  if(composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n  #endif\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\nuniform float opacity;\nin vec4 vColor;\n\nout vec4 fragmentColor;\n#ifndef MODULE_PBR\n  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n    in vec2 vTEXCOORD_0;\n    uniform sampler2D u_BaseColorSampler;\n  #endif\n#endif\n\nvoid main(void) {\n  #ifdef MODULE_PBR\n    fragmentColor = vColor * pbr_filterColor(vec4(0));\n    geometry.uv = pbr_vUV;\n  #else\n    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);\n      geometry.uv = vTEXCOORD_0;\n    #else\n      fragmentColor = vColor;\n    #endif\n  #endif\n\n  fragmentColor.a *= opacity;\n  DECKGL_FILTER_COLOR(fragmentColor, geometry);\n}\n",modules:e}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:N,transition:!0},instanceModelMatrix:I.a})}},{key:"updateState",value:function(e){Object(m.a)(Object(h.a)(n.prototype),"updateState",this).call(this,e);var t=e.props,r=e.oldProps;t.scenegraph!==r.scenegraph?this._updateScenegraph(t):t._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,t._animations)}},{key:"finalizeState",value:function(){Object(m.a)(Object(h.a)(n.prototype),"finalizeState",this).call(this),this._deleteScenegraph()}},{key:"_updateScenegraph",value:function(e){var t=this,n=this.context.gl,r=null;if(e.scenegraph instanceof w.a)r={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){var i=e.scenegraph,a=Object(S.a)(n,i,this._getModelOptions());r=j({gltf:i},a),function(e){return P.apply(this,arguments)}(a).then((function(){return t.setNeedsRedraw()}))}else e.scenegraph&&(g.a.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=e.scenegraph);var o={layer:this,gl:n},s=e.getScene(r,o),c=e.getAnimator(r,o);s instanceof w.a?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,c,e._animations),this.setState({scenegraph:s,animator:c})):null!==s&&g.a.warn("invalid scenegraph:",s)()}},{key:"_applyAllAttributes",value:function(e){var t=this;if(this.state.attributesAvailable){var n=this.getAttributeManager().getAttributes();e.traverse((function(e){t._setModelAttributes(e.model,n)}))}}},{key:"_applyAnimationsProp",value:function(e,t,n){if(e&&t&&n){var r=t.getAnimations();Object.keys(n).sort().forEach((function(e){var t=n[e];if("*"===e)r.forEach((function(e){Object.assign(e,t)}));else if(Number.isFinite(Number(e))){var i=Number(e);i>=0&&i<r.length?Object.assign(r[i],t):g.a.warn("animation ".concat(e," not found"))()}else{var a=r.find((function(t){return t.name===e}));a?Object.assign(a,t):g.a.warn("animation ".concat(e," not found"))()}}))}}},{key:"_deleteScenegraph",value:function(){var e=this.state.scenegraph;e instanceof w.a&&e.delete()}},{key:"_getModelOptions",value:function(){var e=this.props._imageBasedLightingEnvironment,t=null;return e&&(t="function"==typeof e?e({gl:this.context.gl,layer:this}):e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:t,modelOptions:j({isInstanced:!0,transpileToGLSL100:!Object(_.i)(this.context.gl)},this.getShaders()),useTangents:!1}}},{key:"updateAttributes",value:function(e){var t=this;this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse((function(n){t._setModelAttributes(n.model,e)}))}},{key:"draw",value:function(e){var t=e.moduleParameters,n=void 0===t?null:t,r=e.parameters,i=void 0===r?{}:r,a=e.context;if(this.state.scenegraph){this.props._animations&&this.state.animator&&(this.state.animator.animate(a.timeline.getTime()),this.setNeedsRedraw());var o=this.context.viewport,s=this.props,c=s.sizeScale,u=s.sizeMinPixels,l=s.sizeMaxPixels,h=s.opacity,f=s.coordinateSystem,p=this.getNumInstances();this.state.scenegraph.traverse((function(e,t){var r=t.worldMatrix;e.model.setInstanceCount(p),e.updateModuleSettings(n),e.draw({parameters:i,uniforms:{sizeScale:c,opacity:h,sizeMinPixels:u,sizeMaxPixels:l,composeModelMatrix:Object(I.b)(o,f),sceneModelMatrix:r,u_Camera:e.model.getUniforms().project_uCameraPosition}})}))}}}]),n}(O.a);L.layerName="ScenegraphLayer",L.defaultProps=R;var k=n("A28A"),D=n("ykdB"),U=n("+w+S");function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var q=function(e){Object(u.a)(n,e);var t=B(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getShaders",value:function(){var e=Object(m.a)(Object(h.a)(n.prototype),"getShaders",this).call(this);return e.modules.push(T.a),V(V({},e),{},{vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nuniform bool u_pickFeatureIds;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec4 uvRegions;\nin vec3 featureIdsPickingColors;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvoid main(void) {\n  vec2 uv = fract(texCoords) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;\n\n  geometry.uv = uv;\n  geometry.uv = texCoords;\n\n  if (u_pickFeatureIds) {\n    geometry.pickingColor = featureIdsPickingColors;\n  } else {\n    geometry.pickingColor = instancePickingColors;\n  }\n\n  #ifdef MODULE_PBR\n    #ifdef HAS_NORMALS\n      pbr_vNormal = project_normal(instanceModelMatrix * normals);\n      geometry.normal = pbr_vNormal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = uv;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  vTexCoord = uv;\n  cameraPosition = project_uCameraPosition;\n  normals_commonspace = project_normal(instanceModelMatrix * normals);\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n  geometry.normal = normals_commonspace;\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale;\n  vec3 projectedPosition = project_position(positions);\n  position_commonspace = vec4(projectedPosition, 1.0);\n  gl_Position = project_common_position_to_clipspace(position_commonspace);\n\n  geometry.position = position_commonspace;\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n  #endif\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  \n#ifdef MODULE_PBR\n\n  fragColor = vColor * pbr_filterColor(vec4(0));\n  geometry.uv = pbr_vUV;\n  fragColor.a *= opacity;\n\n#else\n\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n\n#endif\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"})}},{key:"initializeState",value:function(){var e=this.props.featureIds;Object(m.a)(Object(h.a)(n.prototype),"initializeState",this).call(this),e&&this.state.attributeManager.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}},{key:"updateState",value:function(e){var t=e.props,r=e.oldProps,i=e.changeFlags;Object(m.a)(Object(h.a)(n.prototype),"updateState",this).call(this,{props:t,oldProps:r,changeFlags:i}),t.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}},{key:"draw",value:function(e){var t=this.props.featureIds;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,u_pickFeatureIds:Boolean(t)}),Object(m.a)(Object(h.a)(n.prototype),"draw",this).call(this,e))}},{key:"getModel",value:function(e){var t,n=this.props,r=n.id,i=n.pbrMaterial,a=this.parseMaterial(i,e),o=this.getShaders();return(t=e.attributes).COLOR_0||t.colors||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),t.uvRegions||(t.uvRegions={constant:!0,value:new Float32Array([0,0,1,1])}),new D.a(this.context.gl,V(V({},this.getShaders()),{},{id:r,geometry:e,defines:V(V({},o.defines),null==a?void 0:a.defines),parameters:null==a?void 0:a.parameters,isInstanced:!0}))}},{key:"updatePbrMaterialUniforms",value:function(e){var t=this.state.model;if(t){var n=this.props.mesh,r=this.parseMaterial(e,n);t.setUniforms(r.uniforms)}}},{key:"parseMaterial",value:function(e,t){var n=Boolean(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return new k.a(this.context.gl,{attributes:{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},material:V({unlit:n},e),pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}},{key:"calculateFeatureIdsPickingColors",value:function(e){for(var t=this.props.featureIds,n=new Uint8ClampedArray(t.length*e.size),r=[],i=0;i<t.length;i++)this.encodePickingColor(t[i],r),n[3*i]=r[0],n[3*i+1]=r[1],n[3*i+2]=r[2];e.value=n}}]),n}(U.a);q.layerName="_MeshLayer",q.defaultProps={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};var F=n("xszv"),G=(n("wcNg"),n("Nw31")),H=n("zXfU"),Y=n("Ns70"),Q=n("G+eI"),Z=n("Qk7e"),K=n("VnMh"),J=n("wBSN"),W=function(e,t,n){this.item=e,this.previous=t,this.next=n},X=function(){function e(){this.head=null,this.tail=null,this._length=0}var t=e.prototype;return t.add=function(e){var t=new W(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t},t.remove=function(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)},t.splice=function(e,t){e!==t&&(this.remove(t),this._insert(e,t))},t._insert=function(e,t){var n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e,++this._length},Object(c.a)(e,[{key:"length",get:function(){return this._length}}]),e}();function $(e){return null!=e}var ee=function(){function e(){this._list=new X,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}var t=e.prototype;return t.reset=function(){this._list.splice(this._list.tail,this._sentinel)},t.touch=function(e){var t=e._cacheNode;$(t)&&this._list.splice(this._sentinel,t)},t.add=function(e,t,n){$(t._cacheNode)||(t._cacheNode=this._list.add(t),n&&n(e,t))},t.unloadTile=function(e,t,n){var r=t._cacheNode;$(r)&&(this._list.remove(r),t._cacheNode=void 0,n&&n(e,t))},t.unloadTiles=function(e,t){var n=this._trimTiles;this._trimTiles=!1;for(var r=this._list,i=1024*e.maximumMemoryUsage*1024,a=this._sentinel,o=r.head;o!==a&&(e.gpuMemoryUsageInBytes>i||n);){var s=o.item;o=o.next,this.unloadTile(e,s,t)}},t.trim=function(){this._trimTiles=!0},e}();var te=n("rOwd"),ne=new H.a,re=new H.a,ie=new te.c([new te.e,new te.e,new te.e,new te.e,new te.e,new te.e]);function ae(e,t){var n=e.cameraDirection,r=e.cameraUp,i=e.height,a=e.distanceScales.metersPerUnit,o=[e.longitude,e.latitude,0],s=Y.a.WGS84.cartographicToCartesian(o,new H.a),c=Y.a.WGS84.eastNorthUpToFixedFrame(s),u=e.unprojectPosition(e.cameraPosition),l=Y.a.WGS84.cartographicToCartesian(u,new H.a),h=new H.a(c.transformAsVector(new H.a(n).scale(a))).normalize(),f=new H.a(c.transformAsVector(new H.a(r).scale(a))).normalize();return function(e,t){var n=e.getFrustumPlanes(),r=0;for(var i in n){var a=n[i],o=a.normal.dot(e.center);re.copy(a.normal).scale(a.distance-o).add(e.center);var s=e.unprojectPosition(re),c=Y.a.WGS84.cartographicToCartesian(s,new H.a);ie.planes[r++].fromPointNormal(c,ne.copy(t).subtract(c))}}(e,s),{camera:{position:l,direction:h,up:f},viewport:e,height:i,cullingVolume:ie,frameNumber:t,sseDenominator:1.15}}var oe=new H.a;function se(e){var t=e.halfAxes,n=e.radius,r=e.width,i=e.height;if(t){var a=function(e){e.getColumn(0,oe);var t=e.getColumn(1),n=e.getColumn(2);return oe.add(t).add(n).len()}(t);return Math.log2(6356752.314245179/a)}return n?Math.log2(6356752.314245179/n):i&&r?(Math.log2(6378137/r)+Math.log2(6378137/i))/2:1}var ce=n("FJ6+"),ue=n("KQm4"),le=n("a3TU"),he=n("Xjzu"),fe=n("GA6j");function pe(e){return null!=e}var de=new H.a,ye=new H.a,me=new H.a;function ve(e,t,n){if(Object(Z.a)(e,"3D Tile: boundingVolume must be defined"),e.box)return function(e,t,n){var r=new H.a(e[0],e[1],e[2]);t.transform(r,r);var i=[];if(10===e.length){var a=e.slice(3,6),o=new he.a;o.fromArray(e,6);var s=new H.a([1,0,0]),c=new H.a([0,1,0]),u=new H.a([0,0,1]);s.transformByQuaternion(o),s.scale(a[0]),c.transformByQuaternion(o),c.scale(a[1]),u.transformByQuaternion(o),u.scale(a[2]),i=[].concat(Object(ue.a)(s.toArray()),Object(ue.a)(c.toArray()),Object(ue.a)(u.toArray()))}else i=[].concat(Object(ue.a)(e.slice(3,6)),Object(ue.a)(e.slice(6,9)),Object(ue.a)(e.slice(9,12)));var l=t.transformAsVector(i.slice(0,3)),h=t.transformAsVector(i.slice(3,6)),f=t.transformAsVector(i.slice(6,9)),p=new fe.a([l[0],l[1],l[2],h[0],h[1],h[2],f[0],f[1],f[2]]);if(pe(n))return n.center=r,n.halfAxes=p,n;return new te.d(r,p)}(e.box,t,n);if(e.region){var r=e.region,i=r[0],a=r[1],o=r[2],s=r[3],c=r[4],u=r[5],l=Y.a.WGS84.cartographicToCartesian([Object(le.c)(i),Object(le.c)(s),c],ye),h=Y.a.WGS84.cartographicToCartesian([Object(le.c)(o),Object(le.c)(a),u],me),f=(new H.a).addVectors(l,h).multiplyScalar(.5),p=(new H.a).subVectors(l,h).len()/2;return be([f[0],f[1],f[2],p],new G.a)}if(e.sphere)return be(e.sphere,t,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function be(e,t,n){var r=new H.a(e[0],e[1],e[2]);t.transform(r,r);var i=t.getScale(de),a=Math.max(Math.max(i[0],i[1]),i[2]),o=e[3]*a;return pe(n)?(n.center=r,n.radius=o,n):new te.b(r,o)}new H.a,new H.a,new G.a,new H.a,new H.a,new H.a;function ge(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){var n=e.dynamicScreenSpaceErrorComputedDensity,r=e.dynamicScreenSpaceErrorFactor;return function(e,t){var n=e*t;return 1-Math.exp(-n*n)}(t,n)*r}return 0}function Oe(e,t){var n=t.viewport,r=new(0,n.constructor)({longitude:n.longitude,latitude:n.latitude,height:n.height,width:n.width,bearing:n.bearing,zoom:n.zoom,pitch:0}),i=e.header.mbs[1],a=e.header.mbs[0],o=e.header.mbs[2],s=e.header.mbs[3],c=Object(ue.a)(e.boundingVolume.center),u=r.unprojectPosition(r.cameraPosition),l=Y.a.WGS84.cartographicToCartesian(u,new H.a),h=new H.a(l).subtract(c).normalize(),f=new G.a;Y.a.WGS84.eastNorthUpToFixedFrame(c,f);var p=new G.a(f).invert(),d=new H.a(l).transform(p),y=Math.sqrt(d[0]*d[0]+d[1]*d[1]),m=y*y/d[2],v=new H.a([d[0],d[1],m]).transform(f),b=new H.a(v).subtract(c).normalize(),g=h.cross(b).normalize().scale(s),O=new H.a(c).add(g),_=Y.a.WGS84.cartesianToCartographic(O),T=r.project([a,i,o]),w=r.project(_);return new H.a(T).subtract(w).magnitude()}var _e=function(){function e(e){void 0===e&&(e=0),this._map=new Map,this._array=new Array(e),this._length=e}var t=e.prototype;return t.get=function(e){return Object(Z.a)(e<this._array.length),this._array[e]},t.set=function(e,t){Object(Z.a)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)},t.delete=function(e){var t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)},t.peek=function(){return this._array[this._length-1]},t.push=function(e){if(!this._map.has(e)){var t=this.length++;this._array[t]=e,this._map.set(e,t)}},t.pop=function(){var e=this._array[--this.length];return this._map.delete(e),e},t.reserve=function(e){Object(Z.a)(e>=0),e>this._array.length&&(this._array.length=e)},t.resize=function(e){Object(Z.a)(e>=0),this.length=e},t.trim=function(e){null==e&&(e=this.length),this._array.length=e},t.reset=function(){this._array=[],this._map=new Map,this._length=0},t.find=function(e){return this._map.has(e)},Object(c.a)(e,[{key:"length",get:function(){return this._length},set:function(e){this._length=e,e>this._array.length&&(this._array.length=e)}},{key:"values",get:function(){return this._array}}]),e}();function Te(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return we(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return we(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pe={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:function(){},viewportTraversersMap:{},basePath:""},xe=function(){function e(e){this.options=Ee(Ee({},Pe),e),this._traversalStack=new _e,this._emptyTraversalStack=new _e,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}var t=e.prototype;return t.traverse=function(e,t,n){this.root=e,this.options=Ee(Ee({},this.options),n),this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)},t.reset=function(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()},t.executeTraversal=function(e,t){var n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){var r=n.pop(),i=!1;this.canTraverse(r,t)&&(this.updateChildTiles(r,t),i=this.updateAndPushChildren(r,t,n,r.hasRenderContent?r._selectionDepth+1:r._selectionDepth));var a=r.parent,o=Boolean(!a||a._shouldRefine),s=!i;r.hasRenderContent?r.refine===ce.e.ADD?(this.loadTile(r,t),this.selectTile(r,t)):r.refine===ce.e.REPLACE&&(this.loadTile(r,t),s&&this.selectTile(r,t)):(this.emptyTiles[r.id]=r,this.loadTile(r,t),s&&this.selectTile(r,t)),this.touchTile(r,t),r._shouldRefine=i&&o}this.options.onTraversalEnd(t)},t.updateChildTiles=function(e,t){for(var n,r=Te(e.children);!(n=r()).done;){var i=n.value;this.updateTile(i,t)}return!0},t.updateAndPushChildren=function(e,t,n,r){var i=this.options,a=i.loadSiblings,o=i.skipLevelOfDetail,s=e.children;s.sort(this.compareDistanceToCamera.bind(this));for(var c,u=e.refine===ce.e.REPLACE&&e.hasRenderContent&&!o,l=!1,h=!0,f=Te(s);!(c=f()).done;){var p=c.value;if(p._selectionDepth=r,p.isVisibleAndInRequestVolume?(n.find(p)&&n.delete(p),n.push(p),l=!0):(u||a)&&(this.loadTile(p,t),this.touchTile(p,t)),u){var d=void 0;if(d=!!p._inRequestVolume&&(p.hasRenderContent?p.contentAvailable:this.executeEmptyTraversal(p,t)),!(h=h&&d))return!1}}return l||(h=!1),h},t.updateTile=function(e,t){this.updateTileVisibility(e,t)},t.selectTile=function(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)},t.loadTile=function(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)},t.touchTile=function(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber},t.canTraverse=function(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:!(!r&&!e.isVisibleAndInRequestVolume)&&this.shouldRefine(e,t,n))},t.shouldLoadTile=function(e){return e.hasUnloadedContent||e.contentExpired},t.shouldSelectTile=function(e){return e.contentAvailable&&!this.options.skipLevelOfDetail},t.shouldRefine=function(e,t,n){var r=e._screenSpaceError;return n&&(r=e.getScreenSpaceError(t,!0)),r>this.options.maximumScreenSpaceError},t.updateTileVisibility=function(e,t){var n=[];if(this.options.viewportTraversersMap)for(var r in this.options.viewportTraversersMap){this.options.viewportTraversersMap[r]===t.viewport.id&&n.push(r)}else n.push(t.viewport.id);e.updateVisibility(t,n)},t.compareDistanceToCamera=function(e,t){return e._distanceToCamera-t._distanceToCamera},t.anyChildrenVisible=function(e,t){for(var n,r=!1,i=Te(e.children);!(n=i()).done;){var a=n.value;a.updateVisibility(t),r=r||a.isVisibleAndInRequestVolume}return r},t.executeEmptyTraversal=function(e,t){var n=!0,r=this._emptyTraversalStack;for(r.push(e);r.length>0&&n;){var i=r.pop();if(this.updateTile(i,t),i.isVisibleAndInRequestVolume||this.loadTile(i,t),this.touchTile(i,t),!i.hasRenderContent&&this.canTraverse(i,t,!1,!0))for(var a,o=Te(i.children);!(a=o()).done;){var s=a.value;r.find(s)&&r.delete(s),r.push(s)}else i.contentAvailable||(n=!1)}return n},e}();function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ce=new H.a;var je=function(){function e(e,t,n,r){void 0===r&&(r=""),this.header=t,this.tileset=e,this.id=r||t.id,this.url=t.url,this.parent=n,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=ce.d.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.depth=0,this.viewportIds=[],this.userData={},this.extensions=null,this._priority=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._screenSpaceError=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this.traverser=new xe({}),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._initialTransform=new G.a,this.transform=new G.a,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,Object.seal(this)}var t=e.prototype;return t.destroy=function(){this.header=null},t.isDestroyed=function(){return null===this.header},t.getScreenSpaceError=function(e,t){switch(this.tileset.type){case ce.c.I3S:return Oe(this,e);case ce.c.TILES3D:return function(e,t,n){var r=e.tileset,i=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,a=n?i:e.lodMetricValue;if(0===a)return 0;var o=Math.max(e._distanceToCamera,1e-7),s=t.height,c=t.sseDenominator,u=a*s*(r.options.viewDistanceScale||1)/(o*c);return u-=ge(r,o)}(this,e,t);default:throw new Error("Unsupported tileset type")}},t._getPriority=function(){var e=this.tileset._traverser,t=e.options.skipLevelOfDetail,n=this.refine===ce.e.ADD||t;if(n&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(this.contentState===ce.d.UNLOADED)return-1;var r=this.parent,i=r&&(!n||0===this._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-i,0)},t.loadContent=function(){var e=Object(o.a)(i.a.mark((function e(){var t,n,r,a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasEmptyContent){e.next=2;break}return e.abrupt("return",!1);case 2:if(!this.content){e.next=4;break}return e.abrupt("return",!0);case 4:return this.contentExpired&&(this._expireDate=null),this.contentState=ce.d.LOADING,e.next=9,this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));case 9:if(t=e.sent){e.next=13;break}return this.contentState=ce.d.UNLOADED,e.abrupt("return",!1);case 13:return e.prev=13,r=this.tileset.getTileUrl(this.contentUrl),a=this.tileset.loader,o=Ie(Ie({},this.tileset.loadOptions),{},((n={})[a.id]=Ie(Ie({},this.tileset.loadOptions[a.id]),{},{isTileset:"json"===this.type},this._getLoaderSpecificOptions(a.id)),n)),e.next=19,Object(F.a)(r,a,o);case 19:if(this.content=e.sent,!this.tileset.options.contentLoader){e.next=23;break}return e.next=23,this.tileset.options.contentLoader(this);case 23:return this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ce.d.READY,this._onContentLoaded(),e.abrupt("return",!0);case 29:throw e.prev=29,e.t0=e.catch(13),this.contentState=ce.d.FAILED,e.t0;case 33:return e.prev=33,t.done(),e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[13,29,33,36]])})));return function(){return e.apply(this,arguments)}}(),t.unloadContent=function(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ce.d.UNLOADED,!0},t.updateVisibility=function(e,t){if(this._frameNumber!==e.frameNumber){var n=this.parent,r=n?n._visibilityPlaneMask:te.c.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){var i=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(i)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==te.c.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}},t.visibility=function(e,t){var n=e.cullingVolume,r=this.boundingVolume;return n.computeVisibilityWithPlaneMask(r,t)},t.contentVisibility=function(){return!0},t.distanceToTile=function(e){var t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))},t.cameraSpaceZDepth=function(e){var t=e.camera,n=this.boundingVolume;return Ce.subVectors(n.center,t.position),t.direction.dot(Ce)},t.insideViewerRequestVolume=function(e){var t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0},t.updateExpiration=function(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){var e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=ce.d.EXPIRED,this._expiredContent=this.content)}},t._initializeLodMetric=function(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))},t._initializeTransforms=function(e){this.transform=e.transform?new G.a(e.transform):new G.a;var t=this.parent,n=this.tileset,r=t&&t.computedTransform?t.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new G.a(r).multiplyRight(this.transform);var i=t&&t._initialTransform?t._initialTransform.clone():new G.a;this._initialTransform=new G.a(i).multiplyRight(this.transform)},t._initializeBoundingVolumes=function(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)},t._initializeContent=function(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ce.d.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)},t._initializeRenderingState=function(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=te.c.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0},t._getRefine=function(e){return e||this.parent&&this.parent.refine||ce.e.REPLACE},t._isTileset=function(){return-1!==this.contentUrl.indexOf(".json")},t._onContentLoaded=function(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)},t._updateBoundingVolume=function(e){this.boundingVolume=ve(e.boundingVolume,this.computedTransform,this.boundingVolume);var t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=ve(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=ve(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))},t._updateTransform=function(e){void 0===e&&(e=new G.a);var t=e.clone().multiplyRight(this.transform);!t.equals(this.computedTransform)&&(this.computedTransform=t,this._updateBoundingVolume(this.header))},t._getLoaderSpecificOptions=function(e){switch(e){case"i3s":return Ie(Ie({},this.tileset.options.i3s),{},{tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1});case"3d-tiles":case"cesium-ion":default:return{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"}}var t},Object(c.a)(e,[{key:"selected",get:function(){return this._selectedFrame===this.tileset._frameNumber}},{key:"isVisible",get:function(){return this._visible}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"hasChildren",get:function(){return this.children.length>0||this.header.children&&this.header.children.length>0}},{key:"contentReady",get:function(){return this.contentState===ce.d.READY||this.hasEmptyContent}},{key:"contentAvailable",get:function(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this.contentState===ce.d.UNLOADED}},{key:"contentExpired",get:function(){return this.contentState===ce.d.EXPIRED}},{key:"contentFailed",get:function(){return this.contentState===ce.d.FAILED}},{key:"extras",get:function(){return this.header.extras}}]),e}(),Me=n("dI71"),Ne=function(e){function t(){return e.apply(this,arguments)||this}Object(Me.a)(t,e);var n=t.prototype;return n.compareDistanceToCamera=function(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera},n.updateTileVisibility=function(t,n){if(e.prototype.updateTileVisibility.call(this,t,n),t.isVisibleAndInRequestVolume){var r=t.children.length>0;if(t.hasTilesetContent&&r){var i=t.children[0];return this.updateTileVisibility(i,n),void(t._visible=i._visible)}if(this.meetsScreenSpaceErrorEarly(t,n))t._visible=!1;else{var a=t.refine===ce.e.REPLACE,o=t._optimChildrenWithinParent===ce.b.USE_OPTIMIZATION;a&&o&&r&&!this.anyChildrenVisible(t,n)&&(t._visible=!1)}}},n.meetsScreenSpaceErrorEarly=function(e,t){var n=e.parent;return!(!n||n.hasTilesetContent||n.refine!==ce.e.ADD)&&!this.shouldRefine(e,t,!0)},t}(xe),Re="REQUESTED",Le="COMPLETED",ke="ERROR",De=function(){function e(){this._statusMap={}}var t=e.prototype;return t.add=function(e,t,n,r){var i=this;this._statusMap[t]||(this._statusMap[t]={request:e,callback:n,key:t,frameState:r,status:Re},e().then((function(e){i._statusMap[t].status=Le,i._statusMap[t].callback(e,r)})).catch((function(e){i._statusMap[t].status=ke,n(e)})))},t.update=function(e,t){this._statusMap[e]&&(this._statusMap[e].frameState=t)},t.find=function(e){return this._statusMap[e]},e}();function Ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ve(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Be(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var qe=function(e){function t(t){var n;return(n=e.call(this,t)||this)._tileManager=new De,n}Object(Me.a)(t,e);var n=t.prototype;return n.shouldRefine=function(e,t){return e._lodJudge=function(e,t){if(0===e.lodMetricValue||isNaN(e.lodMetricValue))return"DIG";var n=2*Oe(e,t);return n<2?"OUT":!e.header.children||n<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge},n.updateChildTiles=function(e,t){for(var n,r=this,i=e.header.children||[],a=e.children,o=e.tileset,s=function(){var i=n.value,s=i.id+"-"+t.viewport.id,c=a&&a.find((function(e){return e.id===s}));if(c)c&&r.updateTile(c,t);else{var u=function(){return r._loadTile(i.id,o)};r._tileManager.find(s)?r._tileManager.update(s,t):(o.tileset.nodePages&&(u=function(){return o.tileset.nodePagesTile.formTileFromNodePages(i.id)}),r._tileManager.add(u,s,(function(t){return r._onTileLoad(t,e,s)}),t))}},c=Ve(i);!(n=c()).done;)s();return!1},n._loadTile=function(){var e=Object(o.a)(i.a.mark((function e(t,n){var r,a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.loader,a=n.getTileUrl(n.url+"/nodes/"+t),o=ze(ze({},n.loadOptions),{},{i3s:ze(ze({},n.loadOptions.i3s),{},{isTileHeader:!0,loadContent:!1})}),e.next=5,Object(F.a)(a,r,o);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n._onTileLoad=function(e,t,n){var r=new je(t.tileset,e,t,n);t.children.push(r);var i=this._tileManager.find(r.id).frameState;this.updateTile(r,i),this._frameNumber===i.frameNumber&&this.executeTraversal(r,i)},t}(xe);function Fe(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ge(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qe={description:"",ellipsoid:Y.a.WGS84,modelMatrix:new G.a,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(){},onTraversalComplete:function(e){return e},contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Ze=function(){function e(e,t){Object(Z.a)(e),this.options=Ye(Ye({},Qe),t),this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||K.b.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.traverseCounter=0,this.geometricError=0,this._traverser=this._initializeTraverser(),this._cache=new ee,this._requestScheduler=new J.a({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this.frameStateData={},this.lastUpdatedVieports=null,this._queryParams={},this._queryParamsString="",this.maximumMemoryUsage=this.options.maximumMemoryUsage||32,this.gpuMemoryUsageInBytes=0,this.stats=new Q.a({id:this.url}),this._initializeStats(),this._extensionsUsed=void 0,this.dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description||"",this._initializeTileSet(e)}var t=e.prototype;return t.destroy=function(){this._destroy()},t.isLoaded=function(){return 0===this._pendingCount&&0!==this._frameNumber},t.setProps=function(e){this.options=Ye(Ye({},this.options),e)},t.setOptions=function(e){this.options=Ye(Ye({},this.options),e)},t.getTileUrl=function(e){return e.startsWith("data:")?e:""+e+this.queryParams},t.hasExtension=function(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)},t.update=function(e){if((!("loadTiles"in this.options)||this.options.loadTiles)&&!(this.traverseCounter>0)){!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e instanceof Array||(e=[e]),this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;for(var t,n=[],r=Fe(e);!(t=r()).done;){var i=t.value.id;this._needTraverse(i)?n.push(i):this.traverseCounter--}for(var a,o=Fe(e);!(a=o()).done;){var s=a.value,c=s.id;if(this.roots[c]||(this.roots[c]=this._initializeTileHeaders(this.tileset,null)),n.includes(c)){var u=ae(s,this._frameNumber);this._traverser.traverse(this.roots[c],u,this.options)}}}},t._needTraverse=function(e){var t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e},t._onTraversalEnd=function(e){var t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});var n=this.frameStateData[t],r=Object.values(this._traverser.selectedTiles);n.selectedTiles=r,n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()},t._updateTiles=function(){for(var e in this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[],this.frameStateData){var t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(var n,r=Fe(this.selectedTiles);!(n=r()).done;){var i=n.value;this._tiles[i.id]=i}this._loadTiles(),this._unloadTiles(),this._updateStats()},t._tilesChanged=function(e,t){if(e.length!==t.length)return!0;var n=new Set(e.map((function(e){return e.id}))),r=new Set(t.map((function(e){return e.id}))),i=e.filter((function(e){return!r.has(e.id)})).length>0;return i=i||t.filter((function(e){return!n.has(e.id)})).length>0},t._loadTiles=function(){for(var e,t=Fe(this._requestedTiles);!(e=t()).done;){var n=e.value;n.contentUnloaded&&this._loadTile(n)}},t._unloadTiles=function(){this._cache.unloadTiles(this,(function(e,t){return e._unloadTile(t)}))},t._updateStats=function(){for(var e,t=0,n=0,r=Fe(this.selectedTiles);!(e=r()).done;){var i=e.value;i.contentAvailable&&i.content&&(t++,i.content.pointCount&&(n+=i.content.pointCount))}this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=t,this.stats.get("Points").count=n},t._initializeTileSet=function(e){this.root=this._initializeTileHeaders(e,null),this.type===ce.c.TILES3D&&this._initializeCesiumTileset(e),this.type===ce.c.I3S&&this._initializeI3STileset(),this._calculateViewProps()},t._calculateViewProps=function(){var e=this.root;Object(Z.a)(e);var t=e.boundingVolume.center;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new H.a,void(this.zoom=1);this.cartographicCenter=Y.a.WGS84.cartesianToCartographic(t,new H.a),this.cartesianCenter=t,this.zoom=se(e.boundingVolume)},t._initializeStats=function(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")},t._initializeTileHeaders=function(e,t){var n=new je(this,e.root,t);if(t&&(t.children.push(n),n.depth=t.depth+1),this.type===ce.c.TILES3D){var r=[];for(r.push(n);r.length>0;){var i=r.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();for(var a,o=Fe(i.header.children||[]);!(a=o()).done;){var s=a.value,c=new je(this,s,i);i.children.push(c),c.depth=i.depth+1,r.push(c)}}}return n},t._initializeTraverser=function(){var e;switch(this.type){case ce.c.TILES3D:e=Ne;break;case ce.c.I3S:e=qe;break;default:e=xe}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})},t._destroyTileHeaders=function(e){this._destroySubtree(e)},t._loadTile=function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._onStartTileLoading(),e.next=4,t.loadContent();case 4:n=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this._onTileLoadError(t,e.t0);case 10:return e.prev=10,this._onEndTileLoading(),this._onTileLoad(t,n),e.finish(10);case 14:case"end":return e.stop()}}),e,this,[[0,7,10,14]])})));return function(t){return e.apply(this,arguments)}}(),t._onTileLoadError=function(e,t){this.stats.get("Failed Tile Loads").incrementCount();var n=t.message||t.toString(),r=e.url;console.error("A 3D tile failed to load: "+e.url+" "+n),this.options.onTileError(e,n,r)},t._onTileLoad=function(e,t){t&&(e&&e.content&&function(e,t){Object(Z.a)(e),Object(Z.a)(t);var n=t.rtcCenter,r=t.gltfUpAxis,i=e.computedTransform,a=e.boundingVolume.center,o=new G.a(i);switch(n&&o.translate(n),r){case"Z":break;case"Y":var s=(new G.a).rotateX(Math.PI/2);o=o.multiplyRight(s);break;case"X":var c=(new G.a).rotateY(-Math.PI/2);o=o.multiplyRight(c)}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);var u=new H.a(a);t.cartesianModelMatrix=o,t.cartesianOrigin=u;var l=Y.a.WGS84.cartesianToCartographic(u,new H.a),h=Y.a.WGS84.eastNorthUpToFixedFrame(u).invert();t.cartographicModelMatrix=h.multiplyRight(o),t.cartographicOrigin=l,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}(e,e.content),this._addTileToCache(e),this.options.onTileLoad(e))},t._onStartTileLoading=function(){this._pendingCount++,this.stats.get("Tiles Loading").incrementCount()},t._onEndTileLoading=function(){this._pendingCount--,this.stats.get("Tiles Loading").decrementCount()},t._addTileToCache=function(e){this._cache.add(this,e,(function(t){return t._updateCacheStats(e)}))},t._updateCacheStats=function(e){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes},t._unloadTile=function(e){this.gpuMemoryUsageInBytes-=e.content&&e.content.byteLength||0,this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()},t._destroy=function(){var e=[];for(this.root&&e.push(this.root);e.length>0;){for(var t,n=e.pop(),r=Fe(n.children);!(t=r()).done;){var i=t.value;e.push(i)}this._destroyTile(n)}this.root=null},t._destroySubtree=function(e){var t=e,n=[];for(n.push(t);n.length>0;){for(var r,i=Fe((e=n.pop()).children);!(r=i()).done;){var a=r.value;n.push(a)}e!==t&&this._destroyTile(e)}t.children=[]},t._destroyTile=function(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()},t._initializeCesiumTileset=function(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this.extras=e.extras},t._initializeI3STileset=function(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)},Object(c.a)(e,[{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"frameNumber",get:function(){return this._frameNumber}},{key:"queryParams",get:function(){return this._queryParamsString||(this._queryParamsString=function(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];t.push(i+"="+e[i])}switch(t.length){case 0:return"";case 1:return"?"+t[0];default:return"?"+t.join("&")}}(this._queryParams)),this._queryParamsString}}]),e}();var Ke=n("q1ac");function Je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var $e=[0],et={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:null,loader:Ke.a,onTilesetLoad:{type:"function",value:function(e){},compare:!1},onTileLoad:{type:"function",value:function(e){},compare:!1},onTileUnload:{type:"function",value:function(e){},compare:!1},onTileError:{type:"function",value:function(e,t,n){},compare:!1},_getMeshColor:{type:"function",value:function(e){return[255,255,255]},compare:!1}},tt=function(e){Object(u.a)(r,e);var t,n=Xe(r);function r(){return Object(s.a)(this,r),n.apply(this,arguments)}return Object(c.a)(r,[{key:"initializeState",value:function(){"onTileLoadFail"in this.props&&g.a.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}},{key:"isLoaded",get:function(){var e=this.state.tileset3d;return e&&e.isLoaded()}},{key:"shouldUpdateState",value:function(e){return e.changeFlags.somethingChanged}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps,r=e.changeFlags;if(t.data&&t.data!==n.data&&this._loadTileset(t.data),r.viewportChanged){var i=this.state.activeViewports;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(r.propsChanged){var a=this.state.layerMap;for(var o in a)a[o].needsUpdate=!0}}},{key:"activateViewport",value:function(e){var t=this.state,n=t.activeViewports,r=t.lastUpdatedViewports;this.internalState.viewport=e,n[e.id]=e;var i=null==r?void 0:r[e.id];i&&e.equals(i)||(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}},{key:"getPickingInfo",value:function(e){var t=e.info,n=e.sourceLayer,r=this.state.layerMap,i=n&&n.id;if(i){var a=i.substring(this.id.length+1),o=a.substring(a.indexOf("-")+1);t.object=r[o]&&r[o].tile}return t}},{key:"filterSubLayer",value:function(e){var t=e.layer,n=e.viewport,r=t.props.tile,i=n.id;return r.viewportIds.includes(i)}},{key:"_updateAutoHighlight",value:function(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)}},{key:"_loadTileset",value:(t=Object(o.a)(i.a.mark((function e(t){var n,r,a,o,s,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props.loadOptions,r=void 0===n?{}:n,a=this.props.loader||this.props.loaders,Array.isArray(a)&&(a=a[0]),o={loadOptions:We({},r)},!a.preload){e.next=10;break}return e.next=7,a.preload(t,r);case 7:(s=e.sent).headers&&(o.loadOptions.fetch=We(We({},o.loadOptions.fetch),{},{headers:s.headers})),Object.assign(o,s);case 10:return e.next=12,Object(F.a)(t,a,o.loadOptions);case 12:c=e.sent,u=new Ze(c,We({onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileLoadFail:this.props.onTileError},o)),this.setState({tileset3d:u,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(u);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_onTileLoad",value:function(e){var t=this.state.lastUpdatedViewports;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}},{key:"_onTileUnload",value:function(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}},{key:"_updateTileset",value:function(e){var t=this.state.tileset3d,n=this.context.timeline,r=Object.keys(e).length;if(n&&r&&t){var i=t.update(Object.values(e));this.state.frameNumber!==i&&this.setState({frameNumber:i})}}},{key:"_getSubLayer",value:function(e,t){if(!e.content)return null;switch(e.type){case ce.f.POINTCLOUD:return this._makePointCloudLayer(e,t);case ce.f.SCENEGRAPH:return this._make3DModelLayer(e,t);case ce.f.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}},{key:"_makePointCloudLayer",value:function(e,t){var n=e.content,r=n.attributes,i=n.pointCount,a=n.constantRGBA,o=n.cartographicOrigin,s=n.modelMatrix,c=r.positions,u=r.normals,l=r.colors;if(!c)return null;var h=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:c,NORMAL:u,COLOR_0:l}},f=this.props,d=f.pointSize,m=f.getPointColor;return new(this.getSubLayerClass("pointcloud",y.a))({pointSize:d},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:h,coordinateSystem:p.a.METER_OFFSETS,coordinateOrigin:o,modelMatrix:s,getColor:a||m})}},{key:"_make3DModelLayer",value:function(e){var t=e.content,n=t.gltf,r=t.instances,i=t.cartographicOrigin,a=t.modelMatrix;return new(this.getSubLayerClass("scenegraph",L))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:r||$e,scenegraph:n,coordinateSystem:p.a.METER_OFFSETS,coordinateOrigin:i,modelMatrix:a,getTransformMatrix:function(e){return e.modelMatrix},getPosition:[0,0,0]})}},{key:"_makeSimpleMeshLayer",value:function(e,t){var n=e.content,r=n.attributes,i=n.indices,a=n.modelMatrix,o=n.cartographicOrigin,s=n.material,c=n.featureIds,u=this.props._getMeshColor,l=t&&t.props.mesh||new f.a({drawMode:4,attributes:nt(r),indices:i});return new(this.getSubLayerClass("mesh",q))(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:l,data:$e,getColor:u(e),pbrMaterial:s,modelMatrix:a,coordinateOrigin:o,coordinateSystem:p.a.METER_OFFSETS,featureIds:c})}},{key:"renderLayers",value:function(){var e=this,t=this.state,n=t.tileset3d,r=t.layerMap;return n?n.tiles.map((function(t){var n=r[t.id]=r[t.id]||{tile:t},i=n.layer;return t.selected?i?n.needsUpdate?(i=e._getSubLayer(t,i),n.needsUpdate=!1):i.props.visible||(i=i.clone({visible:!0})):i=e._getSubLayer(t):i&&i.props.visible&&(i=i.clone({visible:!1})),n.layer=i,i})).filter(Boolean):null}}]),r}(d.a);function nt(e){var t={};return t.positions=We(We({},e.positions),{},{value:new Float32Array(e.positions.value)}),e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}tt.layerName="Tile3DLayer",tt.defaultProps=et},GA6j:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n("1OyB"),i=n("vuIU"),a=n("Ji7U"),o=n("md7G"),s=n("foSv"),c=n("fxzv"),u=n("+H0l"),l=n("sSh/"),h=n("HwUG"),f=n("ZxFD"),p=n("n+fv");function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var i=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var y=Object.freeze([1,0,0,0,1,0,0,0,1]),m=Object.freeze([0,0,0,0,0,0,0,0,0]),v=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),b={},g=function(e){Object(a.a)(n,e);var t=d(n);function n(e){var i;return Object(r.a)(this,n),i=t.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?i.copy(e):i.identity(),i}return Object(i.a)(n,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return v}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}},{key:"set",value:function(e,t,n,r,i,a,o,s,c){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=c,this.check()}},{key:"setRowMajor",value:function(e,t,n,r,i,a,o,s,c){return this[0]=e,this[1]=r,this[2]=o,this[3]=t,this[4]=i,this[5]=s,this[6]=n,this[7]=a,this[8]=c,this.check()}},{key:"determinant",value:function(){return h.b(this)}},{key:"identity",value:function(){return this.copy(y)}},{key:"fromQuaternion",value:function(e){return h.c(this,e),this.check()}},{key:"transpose",value:function(){return h.i(this,this),this.check()}},{key:"invert",value:function(){return h.d(this,this),this.check()}},{key:"multiplyLeft",value:function(e){return h.e(this,e,this),this.check()}},{key:"multiplyRight",value:function(e){return h.e(this,this,e),this.check()}},{key:"rotate",value:function(e){return h.f(this,this,e),this.check()}},{key:"scale",value:function(e){return Array.isArray(e)?h.g(this,this,e):h.g(this,this,[e,e,e]),this.check()}},{key:"translate",value:function(e){return h.h(this,this,e),this.check()}},{key:"transform",value:function(e,t){switch(e.length){case 2:t=f.i(t||[-0,-0],e,this);break;case 3:t=p.p(t||[-0,-0,-0],e,this);break;case 4:t=Object(l.d)(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Object(u.b)(t,e.length),t}},{key:"transformVector",value:function(e,t){return Object(u.c)("Matrix3.transformVector"),this.transform(e,t)}},{key:"transformVector2",value:function(e,t){return Object(u.c)("Matrix3.transformVector"),this.transform(e,t)}},{key:"transformVector3",value:function(e,t){return Object(u.c)("Matrix3.transformVector"),this.transform(e,t)}}],[{key:"IDENTITY",get:function(){return b.IDENTITY=b.IDENTITY||Object.freeze(new n(y)),b.IDENTITY}},{key:"ZERO",get:function(){return b.ZERO=b.ZERO||Object.freeze(new n(m)),b.ZERO}}]),n}(c.a)},HIr8:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return p}));var r=n("rpwb"),i=n("V3d6");function a(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=Math.PI/180,c=new Float32Array(16),u=new Float32Array(12);function l(e,t,n){var r=t[0]*s,i=t[1]*s,a=t[2]*s,o=Math.sin(a),c=Math.sin(r),u=Math.sin(i),l=Math.cos(a),h=Math.cos(r),f=Math.cos(i),p=n[0],d=n[1],y=n[2];e[0]=p*f*h,e[1]=p*u*h,e[2]=p*-c,e[3]=d*(-u*l+f*c*o),e[4]=d*(f*l+u*c*o),e[5]=d*h*o,e[6]=y*(u*o+f*c*l),e[7]=y*(-f*o+u*c*l),e[8]=y*h*l}function h(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}var f={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update:function(e,t){var n=t.startRow,i=t.endRow,o=this.props,s=o.data,f=o.getOrientation,p=o.getScale,d=o.getTranslation,y=o.getTransformMatrix,m=Array.isArray(y),v=m&&16===y.length,b=Array.isArray(p),g=Array.isArray(f),O=Array.isArray(d),_=v||!m&&Boolean(y(s[0]));e.constant=_?v:g&&b&&O;var T=e.value;if(e.constant){var w;if(_)c.set(y),w=h(c);else l(w=u,f,p),w.set(d,9);e.value=new Float32Array(w)}else{var S,E=n*e.size,P=Object(r.a)(s,n,i),x=P.iterable,A=P.objectInfo,I=a(x);try{for(I.s();!(S=I.n()).done;){var C=S.value;A.index++;var j=void 0;if(_)c.set(v?y:y(C,A)),j=h(c);else l(j=u,g?f:f(C,A),b?p:p(C,A)),j.set(O?d:d(C,A),9);T[E++]=j[0],T[E++]=j[1],T[E++]=j[2],T[E++]=j[3],T[E++]=j[4],T[E++]=j[5],T[E++]=j[6],T[E++]=j[7],T[E++]=j[8],T[E++]=j[9],T[E++]=j[10],T[E++]=j[11]}}catch(M){I.e(M)}finally{I.f()}}}};function p(e,t){return t===i.a.CARTESIAN||t===i.a.METER_OFFSETS||t===i.a.DEFAULT&&!e.isGeospatial}},Ns70:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n("ODXe"),i=n("1OyB"),a=n("vuIU"),o=n("zXfU"),s=n("tS8E"),c=n("gOKY"),u=n("Nw31"),l=n("a3TU"),h=n("n+fv"),f=(Math.max(6378137,6378137,6356752.314245179),function(e){return e}),p=new o.a;function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;return Object(l.f)(e)?(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]):"longitude"in e?(t[0]=n(e.longitude),t[1]=n(e.latitude),t[2]=e.height):(t[0]=n(e.x),t[1]=n(e.y),t[2]=e.z),t}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p;return d(e,t,l.b._cartographicRadians?f:l.j)}function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;return Object(l.f)(t)?(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]):"longitude"in t?(t.longitude=n(e[0]),t.latitude=n(e[1]),t.height=e[2]):(t.x=n(e[0]),t.y=n(e[1]),t.z=e[2]),t}function v(e,t){return m(e,t,l.b._cartographicRadians?f:l.i)}var b=new o.a,g=new o.a,O=new o.a;var _=new o.a,T={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},w={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},S={east:new o.a,north:new o.a,up:new o.a,west:new o.a,south:new o.a,down:new o.a},E=new o.a,P=new o.a,x=new o.a;function A(e,t,n,r,i,a){var o,c,u,h=T[t]&&T[t][n];Object(s.a)(h&&(!r||r===h));var f=_.copy(i);if(Object(l.d)(f.x,0,1e-14)&&Object(l.d)(f.y,0,1e-14)){var p=Math.sign(f.z);o=E.fromArray(w[t]),"east"!==t&&"west"!==t&&o.scale(p),c=P.fromArray(w[n]),"east"!==n&&"west"!==n&&c.scale(p),u=x.fromArray(w[r]),"east"!==r&&"west"!==r&&u.scale(p)}else{var d=S.up,y=S.east,m=S.north;y.set(-f.y,f.x,0).normalize(),e.geodeticSurfaceNormal(f,d),m.copy(d).cross(y);var v=S.west,b=S.south;S.down.copy(d).scale(-1),v.copy(y).scale(-1),b.copy(m).scale(-1),o=S[t],c=S[n],u=S[r]}return a[0]=o.x,a[1]=o.y,a[2]=o.z,a[3]=0,a[4]=c.x,a[5]=c.y,a[6]=c.z,a[7]=0,a[8]=u.x,a[9]=u.y,a[10]=u.z,a[11]=0,a[12]=f.x,a[13]=f.y,a[14]=f.z,a[15]=1,a}var I,C=new o.a,j=new o.a,M=new o.a,N=new o.a,R=new o.a,L=new o.a,k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(i.a)(this,e),Object(s.a)(t>=0),Object(s.a)(n>=0),Object(s.a)(r>=0),this.radii=new o.a(t,n,r),this.radiiSquared=new o.a(t*t,n*n,r*r),this.radiiToTheFourth=new o.a(t*t*t*t,n*n*n*n,r*r*r*r),this.oneOverRadii=new o.a(0===t?0:1/t,0===n?0:1/n,0===r?0:1/r),this.oneOverRadiiSquared=new o.a(0===t?0:1/(t*t),0===n?0:1/(n*n),0===r?0:1/(r*r)),this.minimumRadius=Math.min(t,n,r),this.maximumRadius=Math.max(t,n,r),this.centerToleranceSquared=c.a.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return Object(a.a)(e,[{key:"equals",value:function(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=j,i=M,a=Object(r.a)(e,3),o=a[2];this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);var s=Math.sqrt(n.dot(i));return i.scale(1/s),n.scale(o),i.add(n),i.to(t)}},{key:"cartesianToCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];L.from(e);var n=this.scaleToGeodeticSurface(L,N);if(n){var r=this.geodeticSurfaceNormal(n,j),i=R;i.copy(L).subtract(n);var a=Math.atan2(r.y,r.x),o=Math.asin(r.z),s=Math.sign(h.e(i,L))*h.h(i);return v([a,o,s],t)}}},{key:"eastNorthUpToFixedFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.a;return A(this,"east","north","up",e,t)}},{key:"localFrameToFixedFrame",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.a;return A(this,e,t,n,r,i)}},{key:"geocentricSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return C.from(e).normalize().to(t)}},{key:"geodeticSurfaceNormalCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=y(e),r=n[0],i=n[1],a=Math.cos(i);return C.set(a*Math.cos(r),a*Math.sin(r),Math.sin(i)).normalize(),C.to(t)}},{key:"geodeticSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return C.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}},{key:"scaleToGeodeticSurface",value:function(e,t){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.a,r=t.oneOverRadii,i=t.oneOverRadiiSquared,a=t.centerToleranceSquared;b.from(e);var s=e.x,u=e.y,l=e.z,h=r.x,f=r.y,p=r.z,d=s*s*h*h,y=u*u*f*f,m=l*l*p*p,v=d+y+m,_=Math.sqrt(1/v);if(Number.isFinite(_)){var T=g;if(T.copy(e).scale(_),v<a)return T.to(n);var w=i.x,S=i.y,E=i.z,P=O;P.set(T.x*w*2,T.y*S*2,T.z*E*2);var x,A,I,C,j=(1-_)*e.len()/(.5*P.len()),M=0;do{var N=(x=1/(1+(j-=M)*w))*x,R=(A=1/(1+j*S))*A,L=(I=1/(1+j*E))*I,k=N*x,D=R*A,U=L*I,z=d*k*w+y*D*S+m*U*E,V=-2*z;M=(C=d*N+y*R+m*L-1)/V}while(Math.abs(C)>c.a.EPSILON12);return b.scale([x,A,I]).to(n)}}(e,this,t)}},{key:"scaleToGeocentricSurface",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];N.from(e);var n=N.x,r=N.y,i=N.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*a.x+r*r*a.y+i*i*a.z);return N.multiplyScalar(o).to(t)}},{key:"transformPositionToScaledSpace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return N.from(e).scale(this.oneOverRadii).to(t)}},{key:"transformPositionFromScaledSpace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return N.from(e).scale(this.radii).to(t)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];Object(s.a)(Object(l.d)(this.radii.x,this.radii.y,c.a.EPSILON15)),Object(s.a)(this.radii.z>0),N.from(e);var r=N.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-t))return N.set(0,0,r).to(n)}}],[{key:"WGS84",get:function(){return I=I||new e(6378137,6378137,6356752.314245179)}}]),e}()},OyGM:function(e,t,n){"use strict";(function(e){function r(){var t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if(void 0!==e&&e.hrtime){var n=e.hrtime();t=1e3*n[0]+n[1]/1e6}else t=Date.now();return t}n.d(t,"a",(function(){return r}))}).call(this,n("8oxB"))},"Oz/4":function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n("1OyB"),i=n("vuIU"),a=n("Ji7U"),o=n("md7G"),s=n("foSv"),c=n("sYR6"),u=n("a3TU"),l=n("+H0l"),h=n("ZxFD"),f=n("sSh/");function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var i=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var d=function(e){Object(a.a)(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(r.a)(this,n),e=t.call(this,2),Object(u.f)(i)&&1===arguments.length?e.copy(i):(u.b.debug&&(Object(l.a)(i),Object(l.a)(a)),e[0]=i,e[1]=a),e}return Object(i.a)(n,[{key:"set",value:function(e,t){return this[0]=e,this[1]=t,this.check()}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this.check()}},{key:"fromObject",value:function(e){return u.b.debug&&(Object(l.a)(e.x),Object(l.a)(e.y)),this[0]=e.x,this[1]=e.y,this.check()}},{key:"toObject",value:function(e){return e.x=this[0],e.y=this[1],e}},{key:"ELEMENTS",get:function(){return 2}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(e){return this.transformAsPoint(e)}},{key:"transformAsPoint",value:function(e){return h.j(this,this,e),this.check()}},{key:"transformAsVector",value:function(e){return Object(f.a)(this,this,e),this.check()}},{key:"transformByMatrix3",value:function(e){return h.i(this,this,e),this.check()}},{key:"transformByMatrix2x3",value:function(e){return h.h(this,this,e),this.check()}},{key:"transformByMatrix2",value:function(e){return h.g(this,this,e),this.check()}}]),n}(c.a)},Wium:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n("rePB"),i=n("1OyB"),a=n("vuIU"),o=n("Ji7U"),s=n("md7G"),c=n("foSv"),u=n("wldP"),l=n("c9N0"),h=n("v88f");function f(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(c.a)(e);if(t){var i=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var v=["bearing","pitch"],b={speed:1.2,curve:1.414},g=function(e){Object(o.a)(n,e);var t=m(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.a)(this,n),(e=t.call(this,{compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]})).props=y(y({},b),r),e}return Object(a.a)(n,[{key:"interpolateProps",value:function(e,t,n){var r,i=Object(h.c)(e,t,n,this.props),a=f(v);try{for(a.s();!(r=a.n()).done;){var o=r.value;i[o]=Object(l.e)(e[o]||0,t[o]||0,n)}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"getDuration",value:function(e,t){var n=t.transitionDuration;return"auto"===n&&(n=Object(h.f)(e,t,this.props)),n}}]),n}(u.a)},gOKY:function(e,t,n){"use strict";t.a={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI}},q1ac:function(e,t,n){"use strict";n.d(t,"a",(function(){return it}));var r=n("o0o1"),i=n.n(r),a=(n("wcNg"),n("HaE+")),o=n("VnMh"),s=n("FJ6+"),c="undefined"!=typeof __VERSION__?__VERSION__:"latest",u={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"},l=(Object.keys(u),n("Qk7e"));function h(e,t,n){Object(l.a)(e instanceof ArrayBuffer);var r=new TextDecoder("utf8"),i=new Uint8Array(e,t,n);return r.decode(i)}function f(e,t){void 0===t&&(t=0);var n=new DataView(e);return""+String.fromCharCode(n.getUint8(t+0))+String.fromCharCode(n.getUint8(t+1))+String.fromCharCode(n.getUint8(t+2))+String.fromCharCode(n.getUint8(t+3))}var p=n("rePB"),d=n("F2Cy");function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v,b={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},g=m(m({},{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6}),b),O=n("zXfU"),_=((v={})[b.DOUBLE]=Float64Array,v[b.FLOAT]=Float32Array,v[b.UNSIGNED_SHORT]=Uint16Array,v[b.UNSIGNED_INT]=Uint32Array,v[b.UNSIGNED_BYTE]=Uint8Array,v[b.BYTE]=Int8Array,v[b.SHORT]=Int16Array,v[b.INT]=Int32Array,v),T={DOUBLE:b.DOUBLE,FLOAT:b.FLOAT,UNSIGNED_SHORT:b.UNSIGNED_SHORT,UNSIGNED_INT:b.UNSIGNED_INT,UNSIGNED_BYTE:b.UNSIGNED_BYTE,BYTE:b.BYTE,SHORT:b.SHORT,INT:b.INT},w=function(){function e(){}return e.fromTypedArray=function(e){for(var t in e=ArrayBuffer.isView(e)?e.constructor:e,_){if(_[t]===e)return t}throw new Error("Failed to convert GL type")},e.fromName=function(e){var t=T[e];if(!t)throw new Error("Failed to convert GL type");return t},e.getArrayType=function(e){switch(e){case b.UNSIGNED_SHORT_5_6_5:case b.UNSIGNED_SHORT_4_4_4_4:case b.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:var t=_[e];if(!t)throw new Error("Failed to convert GL type");return t}},e.getByteSize=function(t){return e.getArrayType(t).BYTES_PER_ELEMENT},e.validate=function(t){return Boolean(e.getArrayType(t))},e.createTypedArray=function(t,n,r,i){return void 0===r&&(r=0),void 0===i&&(i=(n.byteLength-r)/e.getByteSize(t)),new(e.getArrayType(t))(n,r,i)},e}(),S=function(){function e(e,t){this.featuresLength=0,this._cachedTypedArrays={},this.json=e,this.buffer=t}var t=e.prototype;return t.getExtension=function(e){return this.json.extensions&&this.json.extensions[e]},t.hasProperty=function(e){return Boolean(this.json[e])},t.getGlobalProperty=function(e,t,n){void 0===t&&(t=g.UNSIGNED_INT),void 0===n&&(n=1);var r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,r.byteOffset):r},t.getPropertyArray=function(e,t,n){var r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(t=w.fromName(r.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,t,r)},t.getProperty=function(e,t,n,r,i){var a=this.json[e];if(!a)return a;var o=this.getPropertyArray(e,t,n);if(1===n)return o[r];for(var s=0;s<n;++s)i[s]=o[n*r+s];return i},t._getTypedArrayFromBinary=function(e,t,n,r,i){var a=this._cachedTypedArrays,o=a[e];return o||(o=w.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+i,r*n),a[e]=o),o},t._getTypedArrayFromArray=function(e,t,n){var r=this._cachedTypedArrays,i=r[e];return i||(i=w.createTypedArray(t,n),r[e]=i),i},e}(),E=n("KQm4"),P={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},x={SCALAR:function(e,t){return e[t]},VEC2:function(e,t){return[e[2*t+0],e[2*t+1]]},VEC3:function(e,t){return[e[3*t+0],e[3*t+1],e[3*t+2]]},VEC4:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT2:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT3:function(e,t){return[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]]},MAT4:function(e,t){return[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]}},A={SCALAR:function(e,t,n){t[n]=e},VEC2:function(e,t,n){t[2*n+0]=e[0],t[2*n+1]=e[1]},VEC3:function(e,t,n){t[3*n+0]=e[0],t[3*n+1]=e[1],t[3*n+2]=e[2]},VEC4:function(e,t,n){t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT2:function(e,t,n){t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT3:function(e,t,n){t[9*n+0]=e[0],t[9*n+1]=e[1],t[9*n+2]=e[2],t[9*n+3]=e[3],t[9*n+4]=e[4],t[9*n+5]=e[5],t[9*n+6]=e[6],t[9*n+7]=e[7],t[9*n+8]=e[8],t[9*n+9]=e[9]},MAT4:function(e,t,n){t[16*n+0]=e[0],t[16*n+1]=e[1],t[16*n+2]=e[2],t[16*n+3]=e[3],t[16*n+4]=e[4],t[16*n+5]=e[5],t[16*n+6]=e[6],t[16*n+7]=e[7],t[16*n+8]=e[8],t[16*n+9]=e[9],t[16*n+10]=e[10],t[16*n+11]=e[11],t[16*n+12]=e[12],t[16*n+13]=e[13],t[16*n+14]=e[14],t[16*n+15]=e[15]}};var I=function(e){return void 0!==e};function C(e,t,n){if(!t)return null;var r=e.getExtension("3DTILES_batch_table_hierarchy"),i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,r=i),r?function(e,t){var n,r,i,a,o=e.instancesLength,s=e.classes,c=e.classIds,u=e.parentCounts,l=e.parentIds,h=o;I(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,o));if(I(u))for(I(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,o)),a=new Uint16Array(o),h=0,n=0;n<o;++n)a[n]=h,h+=u[n];I(l)&&I(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),l=i.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,h));var f=s.length;for(n=0;n<f;++n){var p=s[n].length,d=s[n].instances,y=getBinaryProperties(p,d,t);s[n].instances=combine(y,d)}var m=new Array(f).fill(0),v=new Uint16Array(o);for(n=0;n<o;++n)r=c[n],v[n]=m[r],++m[r];var b={classes:s,classIds:c,classIndexes:v,parentCounts:u,parentIndexes:a,parentIds:l};return function(e){for(var t=e.classIds.length,n=0;n<t;++n)M(e,n,stack)}(b),b}(r,n):null}function j(e,t,n){if(e){var r=e.parentCounts;return e.parentIds?n(e,t):r>0?function(e,t,n){var r=e.classIds,i=e.parentCounts,a=e.parentIds,o=e.parentIndexes,s=r.length,c=scratchVisited;c.length=Math.max(c.length,s);var u=++marker,l=scratchStack;l.length=0,l.push(t);for(;l.length>0;)if(t=l.pop(),c[t]!==u){c[t]=u;var h=n(e,t);if(I(h))return h;for(var f=i[t],p=o[t],d=0;d<f;++d){var y=a[p+d];y!==t&&l.push(y)}}return null}(e,t,n):function(e,t,n){var r=!0;for(;r;){var i=n(e,t);if(I(i))return i;var a=e.parentIds[t];r=a!==t,t=a}throw new Error("traverseHierarchySingleParent")}(e,t,n)}}function M(e,t,n){var r=e.parentCounts,i=e.parentIds,a=e.parentIndexes,o=e.classIds.length;if(I(i)){assert(t<o,"Parent index "+t+" exceeds the total number of instances: "+o),assert(-1===n.indexOf(t),"Circular dependency detected in the batch table hierarchy."),n.push(t);for(var s=I(r)?r[t]:1,c=I(r)?a[t]:t,u=0;u<s;++u){var l=i[c+u];l!==t&&M(e,l,n)}n.pop(t)}}function N(e){return null!=e}var R=function(e,t){return e},L={HIERARCHY:!0,extensions:!0,extras:!0},k=function(){function e(e,t,n,r){var i;for(var a in void 0===r&&(r={}),Object(l.a)(n>=0),this.json=e||{},this.binary=t,this.featureCount=n,this._extensions=(null===(i=this.json)||void 0===i?void 0:i.extensions)||{},this._properties={},this.json)L[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=C(this,this.json,this.binary))}var t=e.prototype;return t.getExtension=function(e){return this.json&&this.json.extensions&&this.json.extensions[e]},t.memorySizeInBytes=function(){return 0},t.isClass=function(e,t){return this._checkBatchId(e),Object(l.a)("string"==typeof t,t),!!this._hierarchy&&N(j(this._hierarchy,e,(function(e,n){var r=e.classIds[n];return e.classes[r].name===t})))},t.isExactClass=function(e,t){return Object(l.a)("string"==typeof t,t),this.getExactClassName(e)===t},t.getExactClassName=function(e){if(this._checkBatchId(e),this._hierarchy){var t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}},t.hasProperty=function(e,t){return this._checkBatchId(e),Object(l.a)("string"==typeof t,t),N(this._properties[t])||this._hasPropertyInHierarchy(e,t)},t.getPropertyNames=function(e,t){var n;this._checkBatchId(e),(t=N(t)?t:[]).length=0;var r=Object.keys(this._properties);return(n=t).push.apply(n,Object(E.a)(r)),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t},t.getProperty=function(e,t){if(this._checkBatchId(e),Object(l.a)("string"==typeof t,t),this._binaryProperties){var n=this._binaryProperties[t];if(N(n))return this._getBinaryProperty(n,e)}var r=this._properties[t];if(N(r))return R(r[e]);if(this._hierarchy){var i=this._getHierarchyProperty(e,t);if(N(i))return i}},t.setProperty=function(e,t,n){var r=this.featureCount;if(this._checkBatchId(e),Object(l.a)("string"==typeof t,t),this._binaryProperties){var i=this._binaryProperties[t];if(i)return void this._setBinaryProperty(i,e,n)}if(!this._hierarchy||!this._setHierarchyProperty(this,e,t,n)){var a=this._properties[t];N(a)||(this._properties[t]=new Array(r),a=this._properties[t]),a[e]=R(n)}},t._checkBatchId=function(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")},t._getBinaryProperty=function(e,t){return e.unpack(e.typedArray,t)},t._setBinaryProperty=function(e,t,n){e.pack(n,e.typedArray,t)},t._initializeBinaryProperties=function(){var e=null;for(var t in this._properties){var n=this._properties[t],r=this._initializeBinaryProperty(t,n);r&&((e=e||{})[t]=r)}return e},t._initializeBinaryProperty=function(e,t){if("byteOffset"in t){var n=t;Object(l.a)(this.binary,"Property "+e+" requires a batch table binary."),Object(l.a)(n.type,"Property "+e+" requires a type.");var r=function(e,t,n,r){var i=e.componentType;Object(l.a)(e.componentType);var a="string"==typeof i?w.fromName(i):i,o=P[e.type],s=x[e.type],c=A[e.type];return n+=e.byteOffset,{values:w.createTypedArray(a,t,n,o*r),type:a,size:o,unpacker:s,packer:c}}(n,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null},t._hasPropertyInHierarchy=function(e,t){if(!this._hierarchy)return!1;var n=j(this._hierarchy,e,(function(e,n){var r=e.classIds[n];return N(e.classes[r].instances[t])}));return N(n)},t._getPropertyNamesInHierarchy=function(e,t){j(this._hierarchy,e,(function(e,n){var r=e.classIds[n],i=e.classes[r].instances;for(var a in i)i.hasOwnProperty(a)&&-1===t.indexOf(a)&&t.push(a)}))},t._getHierarchyProperty=function(e,t){var n=this;return j(this._hierarchy,e,(function(e,r){var i=e.classIds[r],a=e.classes[i],o=e.classIndexes[r],s=a.instances[t];return N(s)?N(s.typedArray)?n._getBinaryProperty(s,o):R(s[o]):null}))},t._setHierarchyProperty=function(e,t,n,r){var i=this,a=j(this._hierarchy,t,(function(e,a){var o=e.classIds[a],s=e.classes[o],c=e.classIndexes[a],u=s.instances[n];return!!N(u)&&(Object(l.a)(a===t,'Inherited property "'+n+'" is read-only.'),N(u.typedArray)?i._setBinaryProperty(u,c,r):u[c]=R(r),!0)}));return N(a)},e}();function D(e,t,n){void 0===n&&(n=0);var r=new DataView(t);if(e.magic=r.getUint32(n,!0),n+=4,e.version=r.getUint32(n,!0),n+=4,e.byteLength=r.getUint32(n,!0),n+=4,1!==e.version)throw new Error("3D Tile Version "+e.version+" not supported");return n}function U(e,t,n){var r,i=new DataView(t);e.header=e.header||{};var a=i.getUint32(n,!0);n+=4;var o=i.getUint32(n,!0);n+=4;var s=i.getUint32(n,!0);n+=4;var c=i.getUint32(n,!0);return n+=4,s>=570425344?(n-=8,r=a,s=o,c=0,a=0,o=0,console.warn("b3dm tile in legacy format.")):c>=570425344&&(n-=4,r=s,s=a,c=o,a=0,o=0,console.warn("b3dm tile in legacy format.")),e.header.featureTableJsonByteLength=a,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=s,e.header.batchTableBinaryByteLength=c,e.header.batchLength=r,n}function z(e,t,n,r){return n=function(e,t,n,r){var i=e.header,a=i.featureTableJsonByteLength,o=i.featureTableBinaryByteLength,s=i.batchLength;if(e.featureTableJson={BATCH_LENGTH:s||0},a>0){var c=h(t,n,a);e.featureTableJson=JSON.parse(c)}return n+=a,e.featureTableBinary=new Uint8Array(t,n,o),n+=o}(e,t,n),n=function(e,t,n,r){var i=e.header,a=i.batchTableJsonByteLength,o=i.batchTableBinaryByteLength;if(a>0){var s=h(t,n,a);e.batchTableJson=JSON.parse(s),n+=a,o>0&&(e.batchTableBinary=new Uint8Array(t,n,o),e.batchTableBinary=new Uint8Array(e.batchTableBinary),n+=o)}return n}(e,t,n)}function V(e,t){void 0===t&&(t=[0,0,0]);var n=e>>11&31,r=e>>5&63,i=31&e;return t[0]=n<<3,t[1]=r<<2,t[2]=i<<3,t}function B(e,t,n){if(!(t||e&&e.batchIds&&n))return null;var r=e.batchIds,i=e.isRGB565,a=e.pointCount;if(r&&n){for(var o=new Uint8ClampedArray(3*a),s=0;s<a;s++){var c=r[s],u=n.getProperty(c,"dimensions").map((function(e){return 255*e}));o[3*s]=u[0],o[3*s+1]=u[1],o[3*s+2]=u[2]}return{type:g.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(i){for(var l=new Uint8ClampedArray(3*a),h=0;h<a;h++){var f=V(t[h]);l[3*h]=f[0],l[3*h+1]=f[1],l[3*h+2]=f[2]}return{type:g.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}return t&&t.length===3*a?{type:g.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:g.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}var q=n("Oz/4"),F=n("a3TU");n("gOKY");function G(e,t){if(!e)throw new Error("math.gl assertion failed. "+t)}new q.a,new O.a,new q.a,new q.a,new Uint8Array(1);function H(e,t){return void 0===t&&(t=255),Object(F.a)(e,0,t)/t*2-1}function Y(e){return e<0?-1:1}function Q(e,t,n,r){if(G(r),e<0||e>n||t<0||t>n)throw new Error("x and y must be unsigned normalized integers between 0 and "+n);if(r.x=H(e,n),r.y=H(t,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){var i=r.x;r.x=(1-Math.abs(r.y))*Y(i),r.y=(1-Math.abs(i))*Y(r.y)}return r.normalize()}function Z(e,t,n){return Q(e,t,255,n)}var K=new O.a;function J(e,t,n){return e.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){for(var n=new O.a,r=new Float32Array(3*e.pointCount),i=0;i<e.pointCount;i++)n.set(t[3*i],t[3*i+1],t[3*i+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(r,3*i);return r}(e,t)):{type:g.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(e,t,n,r,i){return ee.apply(this,arguments)}function ee(){return(ee=Object(a.a)(i.a.mark((function e(t,n,r,a,o){var s,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=D(t,n,r),r=U(t,n,r),r=z(t,n,r),te(t),s=ne(t),c=s.featureTable,u=s.batchTable,e.next=7,oe(t,c,u,a,o);case 7:return re(t,c,a),ie(t,c,u),ae(t,c),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function ne(e){var t=new S(e.featureTableJson,e.featureTableBinary),n=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=n,e.featuresLength=n,e.pointsLength=n,e.pointCount=n,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",g.FLOAT,3);var r=function(e,t){var n=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",g.UNSIGNED_SHORT,1),e.batchIds)){var r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");var i=e.batchTableJson,a=e.batchTableBinary;n=new k(i,a,r)}return n}(e,t);return{featureTable:t,batchTable:r}}function re(e,t,n){if(!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",g.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){var r=t.getPropertyArray("POSITION_QUANTIZED",g.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",g.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",g.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=J(e,r,n)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function ie(e,t,n){if(!e.attributes.colors){var r=null;t.hasProperty("RGBA")?(r=t.getPropertyArray("RGBA",g.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?r=t.getPropertyArray("RGB",g.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(r=t.getPropertyArray("RGB565",g.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=B(e,r,n)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",g.UNSIGNED_BYTE,4))}function ae(e,t){if(!e.attributes.normals){var n=null;t.hasProperty("NORMAL")?n=t.getPropertyArray("NORMAL",g.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(n=t.getPropertyArray("NORMAL_OCT16P",g.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){for(var n=new Float32Array(3*e.pointsLength),r=0;r<e.pointsLength;r++)Z(t[2*r],t[2*r+1],K),K.toArray(n,3*r);return{type:g.FLOAT,size:2,value:n}}return{type:g.FLOAT,size:2,value:t}}(e,n)}}function oe(e,t,n,r,i){return se.apply(this,arguments)}function se(){return(se=Object(a.a)(i.a.mark((function e(t,n,r,a,o){var s,c,u,l,h,f,p,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((l=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"])&&(u=l.properties),!(h=n.getExtension("3DTILES_draco_point_compression"))){e.next=15;break}if(c=h.properties,f=h.byteOffset,p=h.byteLength,c&&Number.isFinite(f)&&p){e.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:s=t.featureTableBinary.slice(f,f+p),t.hasPositions=Number.isFinite(c.POSITION),t.hasColors=Number.isFinite(c.RGB)||Number.isFinite(c.RGBA),t.hasNormals=Number.isFinite(c.NORMAL),t.hasBatchIds=Number.isFinite(c.BATCH_ID),t.isTranslucent=Number.isFinite(c.RGBA);case 15:if(s){e.next=17;break}return e.abrupt("return",!0);case 17:return d={buffer:s,properties:X(X({},c),u),featureTableProperties:c,batchTableProperties:u,dequantizeInShader:!1},e.next=20,ce(t,d,a,o);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e,t,n,r){return ue.apply(this,arguments)}function ue(){return(ue=Object(a.a)(i.a.mark((function e(t,n,r,a){var o,s,c,u,l,h,f,p,y,m,v,b,g,_,T;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.parse,delete(s=X(X({},r),{},{draco:X(X({},r.draco),{},{extraAttributes:n.batchTableProperties||{}})}))["3d-tiles"],e.next=5,o(n.buffer,d.a,s);case 5:if(c=e.sent,u=c.attributes.POSITION&&c.attributes.POSITION.value,l=c.attributes.COLOR_0&&c.attributes.COLOR_0.value,h=c.attributes.NORMAL&&c.attributes.NORMAL.value,f=c.attributes.BATCH_ID&&c.attributes.BATCH_ID.value,p=u&&c.attributes.POSITION.value.quantization,y=h&&c.attributes.NORMAL.value.quantization,p&&(m=c.POSITION.data.quantization,v=m.range,t.quantizedVolumeScale=new O.a(v,v,v),t.quantizedVolumeOffset=new O.a(m.minValues),t.quantizedRange=(1<<m.quantizationBits)-1,t.isQuantizedDraco=!0),y&&(t.octEncodedRange=(1<<c.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0),b={},n.batchTableProperties)for(g=0,_=Object.keys(n.batchTableProperties);g<_.length;g++)T=_[g],c.attributes[T]&&c.attributes[T].value&&(b[T.toLowerCase()]=c.attributes[T].value);t.attributes=X({positions:u,colors:B(t,l,void 0),normals:h,batchIds:f},b);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=n("p/I1"),he=n("w0jg"),fe=0,pe=1;function de(e,t,n,r){e.rotateYtoZ=!0;var i=e.byteOffset+e.byteLength-n;if(0===i)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=Object(he.c)(t,n,i),e.gltfByteOffset=0,e.gltfByteLength=i,n%4==0||console.warn(e.type+": embedded glb is not aligned to a 4-byte boundary."),e.byteOffset+e.byteLength}function ye(e,t,n,r){return me.apply(this,arguments)}function me(){return(me=Object(a.a)(i.a.mark((function e(t,n,r,a){var o,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r["3d-tiles"]||{},ve(t,n,r),!o.loadGLTF){e.next=16;break}if(s=a.parse,c=a.fetch,!t.gltfUrl){e.next=9;break}return e.next=7,c(t.gltfUrl,r);case 7:t.gltfArrayBuffer=e.sent,t.gltfByteOffset=0;case 9:if(!t.gltfArrayBuffer){e.next=16;break}return e.next=12,s(t.gltfArrayBuffer,le.a,r,a);case 12:t.gltf=e.sent,delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e,t,n){switch(t){case fe:var r=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=(new TextDecoder).decode(r);e.gltfUrl=i.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case pe:break;default:throw new Error("b3dm: Illegal glTF format field")}}function be(e,t,n,r,i){return ge.apply(this,arguments)}function ge(){return(ge=Object(a.a)(i.a.mark((function e(t,n,r,a,o){var s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Oe(t,n,r,a,o),e.next=3,ye(t,pe,a,o);case 3:return(c=null==t||null===(s=t.gltf)||void 0===s?void 0:s.extensions)&&c.CESIUM_RTC&&(t.rtcCenter=c.CESIUM_RTC.center),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e,t,n,r,i){n=de(e,t,n=z(e,t,n=U(e,t,n=D(e,t,n))),r);var a=new S(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=a.getGlobalProperty("RTC_CENTER",g.FLOAT,3),n}var _e=n("GA6j"),Te=n("Xjzu"),we=n("Nw31"),Se=n("Ns70");function Ee(e,t,n,r,i){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(a.a)(i.a.mark((function e(t,n,r,a,o){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=xe(t,n,r,a,o),e.next=3,ye(t,t.gltfFormat,a,o);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e,t,n,r,i){if(n=D(e,t,n),1!==e.version)throw new Error("Instanced 3D Model version "+e.version+" is not supported");n=U(e,t,n);var a=new DataView(t);if(e.gltfFormat=a.getUint32(n,!0),n=de(e,t,n=z(e,t,n+=4),r),0===e.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var o=new S(e.featureTableJson,e.featureTableBinary),s=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=o.getGlobalProperty("RTC_CENTER",g.FLOAT,3);new k(e.batchTableJson,e.batchTableBinary,s);return function(e,t,n,r){for(var i=[new Array(r),e._batchTable][0],a=new O.a,o=(new O.a,new O.a,new O.a,new _e.a),s=new Te.a,c=new O.a,u={},l=new we.a,h=[],f=[],p=new O.a,d=new O.a,y=0;y<r;y++){var m=void 0;if(t.hasProperty("POSITION"))m=t.getProperty("POSITION",g.FLOAT,3,y,a);else if(t.hasProperty("POSITION_QUANTIZED")){m=t.getProperty("POSITION_QUANTIZED",g.UNSIGNED_SHORT,3,y,a);var v=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",g.FLOAT,3,p);if(!v)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var b=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",g.FLOAT,3,d);if(!b)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var _=0;_<3;_++)m[_]=m[_]/65535*b[_]+v[_]}if(!m)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");a.copy(m),u.translation=a,e.normalUp=t.getProperty("NORMAL_UP",g.FLOAT,3,y,h),e.normalRight=t.getProperty("NORMAL_RIGHT",g.FLOAT,3,y,f);if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",g.UNSIGNED_SHORT,2,h),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",g.UNSIGNED_SHORT,2,f),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(Se.a.WGS84.eastNorthUpToFixedFrame(a,l),l.getRotationMatrix3(o)):o.identity()}!1,s.fromMatrix3(o),u.rotation=s,c.set(1,1,1);var T=t.getProperty("SCALE",g.FLOAT,1,y);Number.isFinite(T)&&c.multiplyByScalar(T);var w=t.getProperty("SCALE_NON_UNIFORM",g.FLOAT,3,y,h);w&&c.scale(w),u.scale=c;var S=t.getProperty("BATCH_ID",g.UNSIGNED_SHORT,1,y);void 0===S&&(S=y);var E=(new we.a).fromQuaternion(u.rotation);l.identity(),l.translate(u.translation),l.multiplyRight(E),l.scale(u.scale);var P=l.clone();i[y]={modelMatrix:P,batchId:S}}e.instances=i}(e,o,0,s),n}function Ae(e,t,n,r,i,a){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(a.a)(i.a.mark((function e(t,n,r,a,o,s){var c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=D(t,n,r),c=new DataView(n),t.tilesLength=c.getUint32(r,!0),r+=4,t.tiles=[];case 5:if(!(t.tiles.length<t.tilesLength&&t.byteLength-r>12)){e.next=13;break}return u={},t.tiles.push(u),e.next=10,s(n,r,a,o,u);case 10:r=e.sent,e.next=5;break;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ce(e,t,n,r){return je.apply(this,arguments)}function je(){return(je=Object(a.a)(i.a.mark((function e(t,n,r,a){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.rotateYtoZ=!0,t.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",o=a.parse,e.next=5,o(n,le.a,r,a);case 5:t.gltf=e.sent;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e,t,n,r,i){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(a.a)(i.a.mark((function e(t,n,r,a,o){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0===n&&(n=0),void 0===o&&(o={}),o.byteOffset=n,o.type=f(t,n),e.t0=o.type,e.next=e.t0===u.COMPOSITE?7:e.t0===u.BATCHED_3D_MODEL?10:e.t0===u.GLTF?13:e.t0===u.INSTANCED_3D_MODEL?16:e.t0===u.POINT_CLOUD?19:22;break;case 7:return e.next=9,Ae(o,t,n,r,a,Me);case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,be(o,t,n,r,a);case 12:return e.abrupt("return",e.sent);case 13:return e.next=15,Ce(o,t,r,a);case 15:return e.abrupt("return",e.sent);case 16:return e.next=18,Ee(o,t,n,r,a);case 18:return e.abrupt("return",e.sent);case 19:return e.next=21,$(o,t,n,r,a);case 21:return e.abrupt("return",e.sent);case 22:throw new Error("3DTileLoader: unknown type "+o.type);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Re=n("rV1Z");function Le(){return(Le=Object(a.a)(i.a.mark((function e(t){var n,r,a,o,s,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1952609651===new Uint32Array(t.slice(0,4))[0]){e.next=3;break}throw new Error("Wrong subtree file magic number");case 3:if(1===new Uint32Array(t.slice(4,8))[0]){e.next=6;break}throw new Error("Wrong subtree file verson, must be 1");case 6:if(n=Ue(t.slice(8,16)),r=new Uint8Array(t,24,n),a=new TextDecoder("utf8"),o=a.decode(r),s=JSON.parse(o),c=Ue(t.slice(16,24)),u=new ArrayBuffer(0),c&&(u=t.slice(24+n)),!("bufferView"in s.tileAvailability)){e.next=18;break}return e.next=17,ke(s,"tileAvailability",u);case 17:s.tileAvailability.explicitBitstream=e.sent;case 18:if(!("bufferView"in s.contentAvailability)){e.next=22;break}return e.next=21,ke(s,"contentAvailability",u);case 21:s.contentAvailability.explicitBitstream=e.sent;case 22:if(!("bufferView"in s.childSubtreeAvailability)){e.next=26;break}return e.next=25,ke(s,"childSubtreeAvailability",u);case 25:s.childSubtreeAvailability.explicitBitstream=e.sent;case 26:return e.abrupt("return",s);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e,t,n){return De.apply(this,arguments)}function De(){return(De=Object(a.a)(i.a.mark((function e(t,n,r){var a,o,s,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t[n].bufferView,o=t.bufferViews[a],!(s=t.buffers[o.buffer]).uri){e.next=11;break}return e.next=6,Object(Re.a)(s.uri);case 6:return c=e.sent,e.next=9,c.arrayBuffer();case 9:return u=e.sent,e.abrupt("return",new Uint8Array(u,o.byteOffset,o.byteLength));case 11:return e.abrupt("return",new Uint8Array(r,o.byteOffset,o.byteLength));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(e){var t=new DataView(e),n=t.getUint32(0,!0),r=t.getUint32(4,!0);return n+Math.pow(2,32)*r}var ze={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:c,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:function(e){return Le.apply(this,arguments)},options:{}},Ve=n("xszv"),Be={QUADTREE:4,OCTREE:8};function qe(e,t,n,r,i,a){return Fe.apply(this,arguments)}function Fe(){return(Fe=Object(a.a)(i.a.mark((function e(t,n,r,a,o,s){var c,u,l,h,f,p,d,y,m,v,b,g,O,_,T,w,S,E,P,x,A,I,C,j,M,N,R,L,k;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r={mortonIndex:0,x:0,y:0,z:0}),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s={level:0,mortonIndex:0,x:0,y:0,z:0}),c=n.subdivisionScheme,u=n.subtreeLevels,l=n.maximumLevel,h=n.contentUrlTemplate,f=n.subtreesUriTemplate,p=n.basePath,d={children:[],lodMetricValue:0,contentUrl:""},y=Be[c],m=1&a,v=a>>1&1,b=a>>2&1,g=(Math.pow(y,o)-1)/(y-1),O=Ye(r.mortonIndex,a),_=g+O,T=Ye(r.x,m),w=Ye(r.y,v),S=Ye(r.z,b),E=!1,o+1>u&&(E=Ge(t.childSubtreeAvailability,O)),P=Ye(s.x,T),x=Ye(s.y,w),A=Ye(s.z,S),I=o+s.level,!E){e.next=40;break}return C=Qe(p+"/"+f,I,P,x,A),e.next=27,Object(Ve.a)(C,ze);case 27:j=e.sent,t=j,s.mortonIndex=O,s.x=T,s.y=w,s.z=S,s.level=o,O=0,_=0,T=0,w=0,S=0,o=0;case 40:if(Ge(t.tileAvailability,_)&&!(o>l)){e.next=43;break}return e.abrupt("return",d);case 43:Ge(t.contentAvailability,_)&&(d.contentUrl=Qe(h,I,P,x,A)),M=o+1,N={mortonIndex:O,x:T,y:w,z:S},R=0;case 48:if(!(R<y)){e.next=56;break}return e.next=51,qe(t,n,N,R,M,s);case 51:((L=e.sent).contentUrl||L.children.length)&&(k=He(L,I+1,n),d.children.push(k));case 53:R++,e.next=48;break;case 56:return e.abrupt("return",d);case 57:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ge(e,t){return"constant"in e?Boolean(e.constant):!!e.explicitBitstream&&(n=t,r=e.explicitBitstream,i=Math.floor(n/8),a=n%8,1==(r[i]>>a&1));var n,r,i,a}function He(e,t,n){var r=n.basePath,i=n.refine,a=n.getRefine,o=n.lodMetricType,s=n.getTileType,c=n.rootLodMetricValue,u=e.contentUrl&&e.contentUrl.replace(r+"/",""),l=c/Math.pow(2,t);return{children:e.children,contentUrl:e.contentUrl,content:{uri:u},id:e.contentUrl,refine:a(i),type:s(e),lodMetricType:o,lodMetricValue:l}}function Ye(e,t){return parseInt(e.toString(2)+t.toString(2),2)}function Qe(e,t,n,r,i){var a=function(e){var t={};for(var n in e)t["{"+n+"}"]=e[n];return t}({level:t,x:n,y:r,z:i});return e.replace(/{level}|{x}|{y}|{z}/gi,(function(e){return a[e]}))}function Ze(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ke(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Je(e){if(!e.contentUrl)return s.f.EMPTY;var t=e.contentUrl.split(".").pop();switch(t){case"pnts":return s.f.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return s.f.SCENEGRAPH;default:return t}}function We(e){switch(e){case"REPLACE":case"replace":return s.e.REPLACE;case"ADD":case"add":return s.e.ADD;default:return e}}function Xe(e,t){if(!e)return null;if(e.content){var n=e.content.uri||e.content.url;e.contentUrl=t.basePath+"/"+n}return e.id=e.contentUrl,e.lodMetricType=s.a.GEOMETRIC_ERROR,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=Je(e),e.refine=We(e.refine),e}function $e(e){var t=e.basePath,n=Xe(e.root,e),r=[];for(r.push(n);r.length>0;)for(var i,a=Ze((r.pop()||{}).children||[]);!(i=a()).done;){var o=i.value;Xe(o,{basePath:t}),r.push(o)}return n}function et(e){return tt.apply(this,arguments)}function tt(){return(tt=Object(a.a)(i.a.mark((function e(t){var n,r,a,o,c,u,l,h,f,p,d,y,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.root){e.next=2;break}return e.abrupt("return",null);case 2:return n=t.basePath,r=t.root.extensions["3DTILES_implicit_tiling"],a=r.subdivisionScheme,o=r.maximumLevel,c=r.subtreeLevels,u=r.subtrees.uri,l=Qe(u,0,0,0,0),h=n+"/"+l,e.next=9,Object(Ve.a)(h,ze);case 9:return f=e.sent,p=n+"/"+t.root.content.uri,d=t.root.refine,y=t.root.geometricError,m={contentUrlTemplate:p,subtreesUriTemplate:u,subdivisionScheme:a,subtreeLevels:c,maximumLevel:o,refine:d,basePath:n,lodMetricType:s.a.GEOMETRIC_ERROR,rootLodMetricValue:y,getTileType:Je,getRefine:We},e.next=16,nt(t.root,f,m);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e,t,n){return rt.apply(this,arguments)}function rt(){return(rt=Object(a.a)(i.a.mark((function e(t,n,r){var a,o,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return t.lodMetricType=s.a.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,e.next=7,qe(n,r);case 7:return a=e.sent,o=a.children,(c=a.contentUrl)&&(t.contentUrl=c,t.content={uri:c.replace(r.basePath+"/","")}),t.refine=We(t.refine),t.type=Je(t),t.children=o,t.id=t.contentUrl,e.abrupt("return",t);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var it={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:c,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:function(e,t,n){return lt.apply(this,arguments)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function at(e){return o.b.dirname(e.url)}function ot(e,t,n){return st.apply(this,arguments)}function st(){return(st=Object(a.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={content:{featureIds:null}},0,e.next=4,Me(t,0,n,r,a.content);case 4:return e.abrupt("return",a.content);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e,t,n){return ut.apply(this,arguments)}function ut(){return(ut=Object(a.a)(i.a.mark((function e(t,n,r){var a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=JSON.parse((new TextDecoder).decode(t))).loader=n.loader||it,o.url=r.url,o.basePath=at(o),!ht(o)){e.next=10;break}return e.next=7,et(o);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=$e(o);case 11:return o.root=e.t0,o.type=s.c.TILES3D,o.lodMetricType=s.a.GEOMETRIC_ERROR,o.lodMetricValue=(null===(a=o.root)||void 0===a?void 0:a.lodMetricValue)||0,e.abrupt("return",o);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lt(){return(lt=Object(a.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n["3d-tiles"]||{},!("auto"===a.isTileset?r.url&&-1!==r.url.indexOf(".json"):a.isTileset)){e.next=8;break}return e.next=5,ct(t,n,r);case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,ot(t,n,r);case 10:t=e.sent;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ht(e){var t,n;return(null==e||null===(t=e.extensionsRequired)||void 0===t?void 0:t.includes("3DTILES_implicit_tiling"))&&(null==e||null===(n=e.extensionsUsed)||void 0===n?void 0:n.includes("3DTILES_implicit_tiling"))}},rOwd:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return p})),n.d(t,"d",(function(){return N})),n.d(t,"c",(function(){return G})),n.d(t,"e",(function(){return U})),n.d(t,"f",(function(){return ae})),n.d(t,"g",(function(){return xe}));var r=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),i=n("1OyB"),a=n("vuIU"),o=n("zXfU"),s=new o.a,c=new o.a,u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(i.a)(this,e),r=r||s.copy(t).add(n).scale(.5),this.center=new o.a(r),this.halfDiagonal=new o.a(n).subtract(this.center),this.minimum=new o.a(t),this.maximum=new o.a(n)}return Object(a.a)(e,[{key:"clone",value:function(){return new e(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}},{key:"transform",value:function(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}},{key:"intersectPlane",value:function(e){var t=this.halfDiagonal,n=c.from(e.normal),i=t.x*Math.abs(n.x)+t.y*Math.abs(n.y)+t.z*Math.abs(n.z),a=this.center.dot(n)+e.distance;return a-i>0?r.INSIDE:a+i<0?r.OUTSIDE:r.INTERSECTING}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceSquaredTo(e))}},{key:"distanceSquaredTo",value:function(e){var t,n=s.from(e).subtract(this.center),r=this.halfDiagonal,i=0;return(t=Math.abs(n.x)-r.x)>0&&(i+=t*t),(t=Math.abs(n.y)-r.y)>0&&(i+=t*t),(t=Math.abs(n.z)-r.z)>0&&(i+=t*t),i}}]),e}(),l=n("ZaHm"),h=new o.a,f=new o.a,p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(i.a)(this,e),this.radius=-0,this.center=new o.a,this.fromCenterRadius(t,n)}return Object(a.a)(e,[{key:"fromCenterRadius",value:function(e,t){return this.center.from(e),this.radius=t,this}},{key:"fromCornerPoints",value:function(e,t){return t=h.from(t),this.center=(new o.a).from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}},{key:"clone",value:function(){return new e(this.center,this.radius)}},{key:"union",value:function(e){var t=this.center,n=this.radius,r=e.center,i=e.radius,a=h.copy(r).subtract(t),o=a.magnitude();if(n>=o+i)return this.clone();if(i>=o+n)return e.clone();var s=.5*(n+o+i);return f.copy(a).scale((-n+s)/o).add(t),this.center.copy(f),this.radius=s,this}},{key:"expand",value:function(e){var t=(e=h.from(e)).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}},{key:"transform",value:function(e){this.center.transform(e);var t=l.e(h,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(e){return(e=h.from(e)).subtract(this.center).lengthSquared()-this.radius*this.radius}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceSquaredTo(e))}},{key:"intersectPlane",value:function(e){var t=this.center,n=this.radius,i=e.normal.dot(t)+e.distance;return i<-n?r.OUTSIDE:i<n?r.INTERSECTING:r.INSIDE}}]),e}(),d=n("KQm4"),y=n("GA6j"),m=n("Xjzu"),v=new o.a,b=new o.a,g=new o.a,O=new o.a,_=new o.a,T=new o.a,w=new o.a,S=0,E=1,P=2,x=3,A=4,I=5,C=6,j=7,M=8,N=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];Object(i.a)(this,e),this.center=(new o.a).from(t),this.halfAxes=new y.a(n)}return Object(a.a)(e,[{key:"halfSize",get:function(){var e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new o.a(e).len(),new o.a(t).len(),new o.a(n).len()]}},{key:"quaternion",get:function(){var e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),r=new o.a(e).normalize(),i=new o.a(t).normalize(),a=new o.a(n).normalize();return(new m.a).fromMatrix3(new y.a([].concat(Object(d.a)(r),Object(d.a)(i),Object(d.a)(a))))}},{key:"fromCenterHalfSizeQuaternion",value:function(e,t,n){var r=new m.a(n),i=(new y.a).fromQuaternion(r);return i[0]=i[0]*t[0],i[1]=i[1]*t[0],i[2]=i[2]*t[0],i[3]=i[3]*t[1],i[4]=i[4]*t[1],i[5]=i[5]*t[1],i[6]=i[6]*t[2],i[7]=i[7]*t[2],i[8]=i[8]*t[2],this.center=(new o.a).from(e),this.halfAxes=i,this}},{key:"clone",value:function(){return new e(this.center,this.halfAxes)}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}},{key:"getBoundingSphere",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p,t=this.halfAxes,n=t.getColumn(0,g),r=t.getColumn(1,O),i=t.getColumn(2,_),a=v.copy(n).add(r).add(i);return e.center.copy(this.center),e.radius=a.magnitude(),e}},{key:"intersectPlane",value:function(e){var t=this.center,n=e.normal,i=this.halfAxes,a=n.x,o=n.y,s=n.z,c=Math.abs(a*i[S]+o*i[E]+s*i[P])+Math.abs(a*i[x]+o*i[A]+s*i[I])+Math.abs(a*i[C]+o*i[j]+s*i[M]),u=n.dot(t)+e.distance;return u<=-c?r.OUTSIDE:u>=c?r.INSIDE:r.INTERSECTING}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceSquaredTo(e))}},{key:"distanceSquaredTo",value:function(e){var t=b.from(e).subtract(this.center),n=this.halfAxes,r=n.getColumn(0,g),i=n.getColumn(1,O),a=n.getColumn(2,_),o=r.magnitude(),s=i.magnitude(),c=a.magnitude();r.normalize(),i.normalize(),a.normalize();var u,l=0;return(u=Math.abs(t.dot(r))-o)>0&&(l+=u*u),(u=Math.abs(t.dot(i))-s)>0&&(l+=u*u),(u=Math.abs(t.dot(a))-c)>0&&(l+=u*u),l}},{key:"computePlaneDistances",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[-0,-0],r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=this.center,o=this.halfAxes,s=o.getColumn(0,g),c=o.getColumn(1,O),u=o.getColumn(2,_),l=T.copy(s).add(c).add(u).add(a),h=w.copy(l).subtract(e),f=t.dot(h);return r=Math.min(f,r),i=Math.max(f,i),l.copy(a).add(s).add(c).subtract(u),h.copy(l).subtract(e),f=t.dot(h),r=Math.min(f,r),i=Math.max(f,i),l.copy(a).add(s).subtract(c).add(u),h.copy(l).subtract(e),f=t.dot(h),r=Math.min(f,r),i=Math.max(f,i),l.copy(a).add(s).subtract(c).subtract(u),h.copy(l).subtract(e),f=t.dot(h),r=Math.min(f,r),i=Math.max(f,i),a.copy(l).subtract(s).add(c).add(u),h.copy(l).subtract(e),f=t.dot(h),r=Math.min(f,r),i=Math.max(f,i),a.copy(l).subtract(s).add(c).subtract(u),h.copy(l).subtract(e),f=t.dot(h),r=Math.min(f,r),i=Math.max(f,i),a.copy(l).subtract(s).subtract(c).add(u),h.copy(l).subtract(e),f=t.dot(h),r=Math.min(f,r),i=Math.max(f,i),a.copy(l).subtract(s).subtract(c).subtract(u),h.copy(l).subtract(e),f=t.dot(h),r=Math.min(f,r),i=Math.max(f,i),n[0]=r,n[1]=i,n}},{key:"transform",value:function(e){this.center.transformAsPoint(e);var t=this.halfAxes.getColumn(0,g);t.transformAsPoint(e);var n=this.halfAxes.getColumn(1,O);n.transformAsPoint(e);var r=this.halfAxes.getColumn(2,_);return r.transformAsPoint(e),this.halfAxes=new y.a([].concat(Object(d.a)(t),Object(d.a)(n),Object(d.a)(r))),this}},{key:"getTransform",value:function(){throw new Error("not implemented")}}]),e}(),R=n("tS8E"),L=n("a3TU"),k=new o.a,D=new o.a,U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(i.a)(this,e),this.normal=new o.a,this.distance=-0,this.fromNormalDistance(t,n)}return Object(a.a)(e,[{key:"fromNormalDistance",value:function(e,t){return Object(R.a)(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}},{key:"fromPointNormal",value:function(e,t){e=k.from(e),this.normal.from(t).normalize();var n=-this.normal.dot(e);return this.distance=n,this}},{key:"fromCoefficients",value:function(e,t,n,r){return this.normal.set(e,t,n),Object(R.a)(Object(L.d)(this.normal.len(),1)),this.distance=r,this}},{key:"clone",value:function(t){return new e(this.normal,this.distance)}},{key:"equals",value:function(e){return Object(L.d)(this.distance,e.distance)&&Object(L.d)(this.normal,e.normal)}},{key:"getPointDistance",value:function(e){return this.normal.dot(e)+this.distance}},{key:"transform",value:function(e){var t=D.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}},{key:"projectPointOntoPlane",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];e=k.from(e);var n=this.getPointDistance(e),r=D.copy(this.normal).scale(n);return e.subtract(r).to(t)}}]),e}();function z(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return V(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var B=[new o.a([1,0,0]),new o.a([0,1,0]),new o.a([0,0,1])],q=new o.a,F=new o.a,G=(new U(new o.a(1,0,0),0),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(i.a)(this,e),this.planes=t,Object(R.a)(this.planes.every((function(e){return e instanceof U})))}return Object(a.a)(e,[{key:"fromBoundingSphere",value:function(e){this.planes.length=2*B.length;var t,n=e.center,r=e.radius,i=0,a=z(B);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=this.planes[i],c=this.planes[i+1];s||(s=this.planes[i]=new U),c||(c=this.planes[i+1]=new U);var u=q.copy(o).scale(-r).add(n);o.dot(u);s.fromPointNormal(u,o);var l=q.copy(o).scale(r).add(n),h=F.copy(o).negate();h.dot(l);c.fromPointNormal(l,h),i+=2}}catch(f){a.e(f)}finally{a.f()}return this}},{key:"computeVisibility",value:function(e){Object(R.a)(e);var t,n=r.INSIDE,i=z(this.planes);try{for(i.s();!(t=i.n()).done;){var a=t.value;switch(e.intersectPlane(a)){case r.OUTSIDE:return r.OUTSIDE;case r.INTERSECTING:n=r.INTERSECTING}}}catch(o){i.e(o)}finally{i.f()}return n}},{key:"computeVisibilityWithPlaneMask",value:function(t,n){if(Object(R.a)(t,"boundingVolume is required."),Object(R.a)(Number.isFinite(n),"parentPlaneMask is required."),n===e.MASK_OUTSIDE||n===e.MASK_INSIDE)return n;for(var i=e.MASK_INSIDE,a=this.planes,o=0;o<this.planes.length;++o){var s=o<31?1<<o:0;if(!(o<31&&0==(n&s))){var c=a[o],u=t.intersectPlane(c);if(u===r.OUTSIDE)return e.MASK_OUTSIDE;u===r.INTERSECTING&&(i|=s)}}return i}}],[{key:"MASK_OUTSIDE",get:function(){return 4294967295}},{key:"MASK_INSIDE",get:function(){return 0}},{key:"MASK_INDETERMINATE",get:function(){return 2147483647}}]),e}());n("rePB"),n("Nw31");new o.a,new o.a,new o.a,new o.a,new o.a;function H(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Q=new o.a,Z=new o.a,K=new o.a,J=new o.a,W=new o.a,X=new o.a,$=new o.a,ee=new o.a,te=new o.a,ne=new o.a,re=new o.a,ie=new o.a;Math.PI;function ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p;if(!e||0===e.length)return t.fromCenterRadius([0,0,0],0);var n,r=$.copy(e[0]),i=Q.copy(r),a=Z.copy(r),o=K.copy(r),s=J.copy(r),c=W.copy(r),u=X.copy(r),l=H(e);try{for(l.s();!(n=l.n()).done;){var h=n.value;r.copy(h);var f=r.x,d=r.y,y=r.z;f<i.x&&r.copy(i),f>s.x&&r.copy(s),d<a.y&&r.copy(a),d>c.y&&r.copy(c),y<o.z&&r.copy(o),y>u.z&&r.copy(u)}}catch(k){l.e(k)}finally{l.f()}var m=ee.copy(s).subtract(i).magnitudeSquared(),v=ee.copy(c).subtract(a).magnitudeSquared(),b=ee.copy(u).subtract(o).magnitudeSquared(),g=i,O=s,_=m;v>_&&(_=v,g=a,O=c),b>_&&(_=b,g=o,O=u);var T=te;T.x=.5*(g.x+O.x),T.y=.5*(g.y+O.y),T.z=.5*(g.z+O.z);var w=ee.copy(O).subtract(T).magnitudeSquared(),S=Math.sqrt(w),E=ne;E.x=i.x,E.y=a.y,E.z=o.z;var P=re;P.x=s.x,P.y=c.y,P.z=u.z;var x,A=ie.copy(E).add(P).multiplyByScalar(.5),I=0,C=H(e);try{for(C.s();!(x=C.n()).done;){var j=x.value;r.copy(j);var M=ee.copy(r).subtract(A).magnitude();M>I&&(I=M);var N=ee.copy(r).subtract(T).magnitudeSquared();if(N>w){var R=Math.sqrt(N);w=(S=.5*(S+R))*S;var L=R-S;T.x=(S*T.x+L*r.x)/R,T.y=(S*T.y+L*r.y)/R,T.z=(S*T.z+L*r.z)/R}}}catch(k){C.e(k)}finally{C.f()}return S<I?(T.to(t.center),t.radius=S):(A.to(t.center),t.radius=I),t}var oe=n("gOKY"),se=new y.a,ce=new y.a,ue=new y.a,le=new y.a,he=new y.a;function fe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=oe.a.EPSILON20,r=10,i=0,a=0,o=ce,s=ue;o.identity(),s.copy(e);for(var c=n*pe(s);a<r&&me(s)>c;)ve(s,le),he.copy(le).transpose(),s.multiplyRight(le),s.multiplyLeft(he),o.multiplyRight(le),++i>2&&(++a,i=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=s.toTarget(t.diagonal),t}function pe(e){for(var t=0,n=0;n<9;++n){var r=e[n];t+=r*r}return Math.sqrt(t)}var de=[1,0,0],ye=[2,2,1];function me(e){for(var t=0,n=0;n<3;++n){var r=e[se.getElementIndex(ye[n],de[n])];t+=2*r*r}return Math.sqrt(t)}function ve(e,t){for(var n=oe.a.EPSILON15,r=0,i=1,a=0;a<3;++a){var o=Math.abs(e[se.getElementIndex(ye[a],de[a])]);o>r&&(i=a,r=o)}var s=de[i],c=ye[i],u=1,l=0;if(Math.abs(e[se.getElementIndex(c,s)])>n){var h,f=(e[se.getElementIndex(c,c)]-e[se.getElementIndex(s,s)])/2/e[se.getElementIndex(c,s)];l=(h=f<0?-1/(-f+Math.sqrt(1+f*f)):1/(f+Math.sqrt(1+f*f)))*(u=1/Math.sqrt(1+h*h))}return y.a.IDENTITY.to(t),t[se.getElementIndex(s,s)]=t[se.getElementIndex(c,c)]=u,t[se.getElementIndex(c,s)]=l,t[se.getElementIndex(s,c)]=-l,t}function be(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ge(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Oe=new o.a,_e=new o.a,Te=new o.a,we=new o.a,Se=new o.a,Ee=new y.a,Pe={diagonal:new y.a,unitary:new y.a};function xe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;if(!e||0===e.length)return t.halfAxes=new y.a([0,0,0,0,0,0,0,0,0]),t.center=new o.a,t;var n,r=e.length,i=new o.a(0,0,0),a=be(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;i.add(s)}}catch(z){a.e(z)}finally{a.f()}var c=1/r;i.multiplyByScalar(c);var u,l=0,h=0,f=0,p=0,d=0,m=0,v=be(e);try{for(v.s();!(u=v.n()).done;){var b=u.value,g=Oe.copy(b).subtract(i);l+=g.x*g.x,h+=g.x*g.y,f+=g.x*g.z,p+=g.y*g.y,d+=g.y*g.z,m+=g.z*g.z}}catch(z){v.e(z)}finally{v.f()}l*=c,h*=c,f*=c,p*=c,d*=c,m*=c;var O=Ee;O[0]=l,O[1]=h,O[2]=f,O[3]=h,O[4]=p,O[5]=d,O[6]=f,O[7]=d,O[8]=m;var _,T=fe(O,Pe),w=T.unitary,S=t.halfAxes.copy(w),E=S.getColumn(0,Te),P=S.getColumn(1,we),x=S.getColumn(2,Se),A=-Number.MAX_VALUE,I=-Number.MAX_VALUE,C=-Number.MAX_VALUE,j=Number.MAX_VALUE,M=Number.MAX_VALUE,R=Number.MAX_VALUE,L=be(e);try{for(L.s();!(_=L.n()).done;){var k=_.value;A=Math.max(k.dot(E),A),I=Math.max(k.dot(P),I),C=Math.max(k.dot(x),C),j=Math.min(k.dot(E),j),M=Math.min(k.dot(P),M),R=Math.min(k.dot(x),R)}}catch(z){L.e(z)}finally{L.f()}E=E.multiplyByScalar(.5*(j+A)),P=P.multiplyByScalar(.5*(M+I)),x=x.multiplyByScalar(.5*(R+C)),t.center.copy(E).add(P).add(x);var D=_e.set(A-j,I-M,C-R).multiplyByScalar(.5),U=new y.a([D[0],0,0,0,D[1],0,0,0,D[2]]);return t.halfAxes.multiplyRight(U),t}},wBSN:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n("rePB"),i=n("G+eI");function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s={id:"request-scheduler",throttleRequests:!0,maxRequests:6},c=function(){function e(e){void 0===e&&(e={}),this.activeRequestCount=0,this.requestQueue=[],this.requestMap=new Map,this.deferredUpdate=null,this.props=o(o({},s),e),this.stats=new i.a({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}var t=e.prototype;return t.scheduleRequest=function(e,t){if(void 0===t&&(t=function(){return 0}),!this.props.throttleRequests)return Promise.resolve({done:function(){}});if(this.requestMap.has(e))return this.requestMap.get(e);var n={handle:e,priority:0,getPriority:t},r=new Promise((function(e){return n.resolve=e,n}));return this.requestQueue.push(n),this.requestMap.set(e,r),this._issueNewRequests(),r},t._issueRequest=function(e){var t=this,n=e.handle,r=e.resolve,i=!1,a=function(){i||(i=!0,t.requestMap.delete(n),t.activeRequestCount--,t._issueNewRequests())};return this.activeRequestCount++,r?r({done:a}):Promise.resolve({done:a})},t._issueNewRequests=function(){var e=this;this.deferredUpdate||(this.deferredUpdate=setTimeout((function(){return e._issueNewRequestsAsync()}),0))},t._issueNewRequestsAsync=function(){this.deferredUpdate=null;var e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(var t=0;t<e;++t){var n=this.requestQueue.shift();n&&this._issueRequest(n)}}},t._updateAllRequests=function(){for(var e=this.requestQueue,t=0;t<e.length;++t){var n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort((function(e,t){return e.priority-t.priority}))},t._updateRequest=function(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)},e}()}}]);