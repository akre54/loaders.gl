(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{zCbf:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return X})),r.d(e,"renderToDOM",(function(){return Y}));var n=r("rePB"),a=r("o0o1"),i=r.n(a),o=(r("wcNg"),r("HaE+")),u=r("JX7q"),s=r("dI71"),l=r("q1tI"),c=r.n(l),d=r("i8i4"),f=r("UP1k"),p=r("rta6"),h=r("yYqN"),b=r("Wium"),m=r("BENj"),y=r("G8qk"),v=r("AQfu"),S=r("xszv"),g=r("B6CW");function w(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return O(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=t[Symbol.iterator]()).next.bind(r)}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _(t,e){return j.apply(this,arguments)}function j(){return(j=Object(o.a)(i.a.mark((function t(e,r){var n,a,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r.attributeName,o=r.attributeType,a){t.next=3;break}return t.abrupt("return",{});case 3:return t.abrupt("return",((n={})[a]=o?x(o,e):null,n));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t,e){switch(t){case g.h:return function(t){var e=[];try{for(var r,n=new DataView(t,0,4).getUint32(0,!0),a=new Uint32Array(t,8,n),i=8+4*n,o=w(a);!(r=o()).done;){var u=r.value,s=new TextDecoder("utf-8"),l=new Uint8Array(t,i,u);e.push(s.decode(l)),i+=u}}catch(c){console.error("Parse string attribute error: ",c.message)}return e}(e);case g.f:return k(e);case g.a:return function(t){return new Float64Array(t,8)}(e);default:return k(e)}}function k(t){return new Uint32Array(t,4)}var P=r("Ow3C"),C="undefined"!=typeof __VERSION__?__VERSION__:"latest",A={name:"I3S Attribute",id:"i3s-attribute",module:"i3s",version:C,mimeTypes:["application/binary"],parse:function(t,e){return T.apply(this,arguments)},extensions:["bin"],options:{},binary:!0};function T(){return(T=Object(o.a)(i.a.mark((function t(e,r){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=_(e,r),t.abrupt("return",e);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function I(t,e,r){return E.apply(this,arguments)}function E(){return(E=Object(o.a)(i.a.mark((function t(e,r,n){var a,o,u,s,l,c,d,f,p,h;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n={}),a=M(e),o=a.attributeStorageInfo,u=a.attributeUrls,o&&u&&r){t.next=4;break}return t.abrupt("return",null);case 4:for(s=[],l=[],c=0;c<o.length;c++)d=Object(P.c)(u[c],n.token),f=o[c].name,p=U(o[c]),h=Object(S.a)(d,A,{attributeName:f,attributeType:p}),l.push(h);return t.prev=7,t.next=10,Promise.allSettled(l);case 10:s=t.sent,t.next=15;break;case 13:t.prev=13,t.t0=t.catch(7);case 15:if(s.length){t.next=17;break}return t.abrupt("return",null);case 17:return t.abrupt("return",W(s,o,r));case 18:case"end":return t.stop()}}),t,null,[[7,13]])})))).apply(this,arguments)}function M(t){return{attributeStorageInfo:t&&t.tileset&&t.tileset.tileset&&t.tileset.tileset.attributeStorageInfo,attributeUrls:t&&t.header&&t.header.attributeUrls}}function U(t){return t.hasOwnProperty("objectIds")?"Oid32":t.hasOwnProperty("attributeValues")?t.attributeValues.valueType:""}function W(t,e,r){var n=t.find((function(t){return t.value.OBJECTID}));if(!n)return null;var a=n.value.OBJECTID.indexOf(r);return a<0?null:function(t,e,r){for(var n={},a=0;a<r.length;a++){var i=r[a].name,o=D(t,a,i);n[i]=F(o,e)}return n}(t,a,e)}function D(t,e,r){var n=t[e];return"rejected"===n.status?null:n.value[r]}function F(t,e){return t&&t[e]?t[e].toString().replace(/\u0000/g,"").trim():""}var L=r("J4mz"),B=r("rlSs"),z=r("lf6B"),N=r("b1et"),V=r("RUzw"),J=r("IP2g"),R=r("wHSu"),q=r("tuoA");function H(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function G(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?H(Object(r),!0).forEach((function(e){Object(n.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Z={longitude:-120,latitude:34,height:600,width:800,pitch:45,maxPitch:60,bearing:0,minZoom:2,maxZoom:30,zoom:14.5},Q={wordBreak:"break-word",position:"absolute",padding:12,zIndex:"10000",maxWidth:300,background:"#000",color:"#fff"},X=function(t){function e(e){var r;return(r=t.call(this,e)||this)._tilesetStatsWidget=null,r.state={url:null,token:null,name:B.b,viewState:Z,selectedMapStyle:q.h,selectedFeatureAttributes:null,selectedFeatureIndex:-1,isAttributesLoading:!1},r._onSelectTileset=r._onSelectTileset.bind(Object(u.a)(r)),r.handleClosePanel=r.handleClosePanel.bind(Object(u.a)(r)),r}Object(s.a)(e,t);var r=e.prototype;return r.componentDidMount=function(){var t;this._memWidget=new L.a(p.a.get("Memory Usage"),{framesPerUpdate:1,formatters:{"GPU Memory":"memory","Buffer Memory":"memory","Renderbuffer Memory":"memory","Texture Memory":"memory"},container:this._statsWidgetContainer}),this._tilesetStatsWidget=new L.a(null,{container:this._statsWidgetContainer});var e=Object(V.a)();t=e?{url:e}:B.a[B.b],this._onSelectTileset(t)},r._onSelectTileset=function(){var t=Object(o.a)(i.a.mark((function t(e){var r,n,a,o,u,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object(V.b)(e.url,e),n=r.tilesetUrl,a=r.token,o=r.name,u=r.metadataUrl,this.setState({tilesetUrl:n,name:o,token:a}),t.next=5,fetch(u).then((function(t){return t.json()}));case 5:s=t.sent,this.setState({metadata:s,selectedFeatureAttributes:null});case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r._updateStatWidgets=function(){this._memWidget.update(),this._tilesetStatsWidget.update()},r._onTilesetLoad=function(t){var e=t.zoom,r=t.cartographicCenter,n=r[0],a=r[1],i=G(G({},this.state.viewState),{},{zoom:e+2.5,longitude:n,latitude:a});this.setState({tileset:t,viewState:G(G({},i),{},{transitionDuration:4e3,transitionInterpolator:new b.a})}),this._tilesetStatsWidget.setStats(t.stats)},r._onViewStateChange=function(t){var e=t.viewState;this.setState({viewState:e})},r._onSelectMapStyle=function(t){var e=t.selectedMapStyle;this.setState({selectedMapStyle:e})},r._renderLayers=function(){var t=this,e=this.state,r=e.tilesetUrl,n=e.token,a=e.selectedFeatureIndex,i={};return n&&(i.token=n),[new y.a({data:r,loader:v.a,onTilesetLoad:this._onTilesetLoad.bind(this),onTileLoad:function(){return t._updateStatWidgets()},onTileUnload:function(){return t._updateStatWidgets()},pickable:!0,loadOptions:i,highlightedObjectIndex:a})]},r.handleClick=function(){var t=Object(o.a)(i.a.mark((function t(e){var r,n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.object&&!(e.index<0)&&e.layer){t.next=3;break}return this.handleClosePanel(),t.abrupt("return");case 3:return r=this.state.token,n={},r&&(n.token=r),this.setState({isAttributesLoading:!0}),t.next=9,I(e.object,e.index,n);case 9:a=t.sent,this.setState({isAttributesLoading:!1}),this.setState({selectedFeatureAttributes:a,selectedFeatureIndex:e.index});case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r._renderStats=function(){var t=this;return c.a.createElement("div",{style:Q,ref:function(e){return t._statsWidgetContainer=e}})},r._renderControlPanel=function(){var t=this.state,e=t.name,r=t.tileset,n=t.token,a=t.metadata,i=t.selectedMapStyle;return c.a.createElement(z.a,{tileset:r,name:e,metadata:a,token:n,onExampleChange:this._onSelectTileset,onMapStyleChange:this._onSelectMapStyle.bind(this),selectedMapStyle:i})},r.getTooltip=function(){if(this.state.isAttributesLoading){var t=document.createElement("div");return Object(d.render)(c.a.createElement(J.a,{icon:R.c}),t),{html:t.innerHTML}}return null},r.handleClosePanel=function(){this.setState({selectedFeatureAttributes:null,selectedFeatureIndex:-1})},r.renderAttributesPanel=function(){var t=this.state.selectedFeatureAttributes,e=t.NAME||t.OBJECTID;return c.a.createElement(N.a,{title:e,handleClosePanel:this.handleClosePanel,attributesObject:t})},r.render=function(){var t=this,e=this._renderLayers(),r=this.state,n=r.viewState,a=r.selectedMapStyle,i=r.selectedFeatureAttributes;return c.a.createElement("div",{style:{position:"relative",height:"100%"}},this._renderStats(),i?this.renderAttributesPanel():this._renderControlPanel(),c.a.createElement(h.a,{layers:e,viewState:n,onViewStateChange:this._onViewStateChange.bind(this),controller:{type:m.a,maxPitch:85},onAfterRender:function(){return t._updateStatWidgets()},getTooltip:function(e){return t.getTooltip(e)},onClick:function(e){return t.handleClick(e)}},c.a.createElement(f.a,{mapStyle:a,preventStyleDiffing:!0})))},e}(l.PureComponent);function Y(t){Object(d.render)(c.a.createElement(X,null),t)}}}]);